<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN"
  "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="utf-8"/><link rel="stylesheet" type="text/css" href="../style.css"/><script src="../permalink.js"/><script src="../navigation.js"/><title>Well-specified Common Lisp — DEFSTRUCT-SLOTS-CONSTRAINTS-NAME</title></head><body><main><nav class="sidebar"><span class="name">Entry Points</span><br/><ol><li><a href="../chap-0.xhtml#section-Figures">Table of Contents</a></li><li><a href="../symbol-index.xhtml#section-SymbolIndex">Symbol Index</a></li><li><a href="../figure-index.xhtml#section-FigureIndex">Figure Index</a></li><li><a href="../issue-index.xhtml#section-IssueIndices">Issue Index</a></li><li><a href="../note-indices.xhtml#section-ReviewerNoteIndex">Note Indices</a></li><li><a href="../chapter-26.xhtml#section-Glossary">Glossary</a></li></ol><hr/><span class="name">DEFSTRUCT-SLOTS-CONSTRAINTS-NAME</span><br/><ol class="local-toc"><li><a href="#section-Status">Status</a><ol> </ol></li><li><a href="#section-References">References</a><ol> </ol></li><li><a href="#section-Edit history">Edit history</a><ol> </ol></li><li><a href="#section-Problem Description">Problem Description</a><ol> </ol></li><li><a href="#issue-defstruct-slots-constraints-name:duplicates-error">Proposal DUPLICATES-ERROR</a><ol> </ol></li><li><a href="#section-Examples">Examples</a><ol> </ol></li><li><a href="#section-Rationale">Rationale</a><ol> </ol></li><li><a href="#section-Current Practice">Current Practice</a><ol> </ol></li><li><a href="#section-Cost to Implementors">Cost to Implementors</a><ol> </ol></li><li><a href="#section-Cost to Users">Cost to Users</a><ol> </ol></li><li><a href="#section-Cost of Non-Adoption">Cost of Non-Adoption</a><ol> </ol></li><li><a href="#section-Benefits">Benefits</a><ol> </ol></li><li><a href="#section-Aesthetics">Aesthetics</a><ol> </ol></li><li><a href="#section-Discussion">Discussion</a><ol> </ol></li></ol></nav><div class="content"><h1>X3J13 Issue DEFSTRUCT-SLOTS-CONSTRAINTS-NAME [NIL] [CLARIFICATION]</h1><section id="section-Status" class="status-passed section"><h2 class="section-title">Status</h2>Passed, Jan 89 X3J13 </section><section id="section-References" class="section"><h2 class="section-title">References</h2>CLtL p.308 &amp; 86-003 p.4 </section><section id="section-Edit history" class="section"><h2 class="section-title">Edit history</h2>Version 1 by Skona Brittain 05/13/88 Version 2, Masinter, 14-Sep-88 Version 3, Masinter, 23-Sep-88 Version 4, Masinter, 31-Oct-88 Version 5, Masinter, 12-Jan-89 </section><section id="section-Problem Description" class="section"><h2 class="section-title">Problem Description</h2>The case of two slots of a structure having the same name is not  discussed in CLtL. Is it allowed?  The problem is that the name of slot accessors and the keyword arguments of the  constructor function is determined only by the <a class="function-reference" href="../chapter-10.xhtml#function-symbol-name">symbol-name</a> of the slot designator; the meaning of slot accessors and the constructor function is unspecified. <br/></section><section class="status-passed proposal" id="issue-defstruct-slots-constraints-name:duplicates-error"><h2 class="section-title">Proposal DUPLICATES-ERROR</h2>It is an error for two slots in a structure type to have the same <a class="function-reference" href="../chapter-10.xhtml#function-symbol-name">symbol-name</a>; that is, the <a class="function-reference" href="../chapter-10.xhtml#function-symbol-name">symbol-name</a> of the slot names should not be <a class="function-reference" href="../chapter-16.xhtml#function-string=">string=</a>. This holds when they were both named directly by the same call to defstruct or when one is present by virtue of being in an included structure. <br/>The situation of expanding a <a class="macro-reference" href="../chapter-8.xhtml#macro-defstruct">defstruct</a> macro with a duplicate name "should signal an error." (While not yet formally defined, the intent is that  the error signalling may occur when compiling a file that contains duplicate names or when evaluating a <a class="macro-reference" href="../chapter-8.xhtml#macro-defstruct">defstruct</a> form with duplicate names in an interpreter.) <br/>This proposal only affects the operation of the <a class="macro-reference" href="../chapter-8.xhtml#macro-defstruct">defstruct</a> macro, and not the <a class="type-reference" href="../chapter-4.xhtml#type-structure-class">structure-class</a> or structures defined with <a class="macro-reference" href="../chapter-7.xhtml#macro-defclass">defclass</a>&gt; <br/></section><section id="section-Examples" class="section"><h2 class="section-title">Examples</h2><pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-8.xhtml#macro-defstruct">defstruct</a> <span class="syntax-interned-symbol">struc</span> <span class="syntax-interned-symbol">slot</span> <span class="syntax-interned-symbol">slot</span>)</span>
</span></code> would be an error.  So would<br/><code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-8.xhtml#macro-defstruct">defstruct</a> <span class="syntax-cons">(<span class="syntax-interned-symbol">struc2</span> <span class="syntax-cons">(<span class="syntax-keyword-symbol">:include</span> <span class="syntax-interned-symbol">struc1</span>)</span>)</span> <span class="syntax-interned-symbol">slot</span>)</span>
</span></code> if preceded by<br/><code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-8.xhtml#macro-defstruct">defstruct</a> <span class="syntax-interned-symbol">struc1</span> <span class="syntax-interned-symbol">slot</span>)</span>
</span></code>.<br/><br/><code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-8.xhtml#macro-defstruct">defstruct</a> <span class="syntax-interned-symbol">struct</span> <span class="syntax-interned-symbol">package-1:slot</span> <span class="syntax-interned-symbol">package-2:slot</span>)</span>
</span></code> is also an<br/>error. Slot accessors are interned in the current <a class="variable-reference" href="../chapter-11.xhtml#variable-*package*">*package*</a><br/>at the time of the evalution of the <a class="macro-reference" href="../chapter-8.xhtml#macro-defstruct">defstruct</a>. <br/><br/></pre></section><section id="section-Rationale" class="section"><h2 class="section-title">Rationale</h2>Since it would be difficult to prescribe reasonable behavior for <a class="macro-reference" href="../chapter-8.xhtml#macro-defstruct">defstruct</a>, it should be considered an error. <br/></section><section id="section-Current Practice" class="section"><h2 class="section-title">Current Practice</h2>In KCL, if two slots have the same name, no warning message is  given but mysterious behavior ensues.  (Their default values are  both whatever is given for the second one, neither can be given a different value via a call to the constructor function, only the  second one's value can be changed by setf...) <br/></section><section id="section-Cost to Implementors" class="section"><h2 class="section-title">Cost to Implementors</h2>None. <br/></section><section id="section-Cost to Users" class="section"><h2 class="section-title">Cost to Users</h2>None. <br/></section><section id="section-Cost of Non-Adoption" class="section"><h2 class="section-title">Cost of Non-Adoption</h2>Possible confusion. <br/></section><section id="section-Benefits" class="section"><h2 class="section-title">Benefits</h2>Clarity. <br/></section><section id="section-Aesthetics" class="section"><h2 class="section-title">Aesthetics</h2>Something that is not well-defined and leads to erratic behavior  should be explicitly considered an error. <br/></section><section id="section-Discussion" class="section"><h2 class="section-title">Discussion</h2>Although this issue was mentioned in Guy's original issues file, it has not been officially discussed since.   <br/>This issue was first circulated to X3J13 June 1988. <br/>This proposal does not address the issue of whether <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a> is a legitimate slot name. There seems to be no current reason why it might be prohibitied. <br/>The compiler committee is proposing to address generally the issue  of how macro-expansion errors during <a class="function-reference" href="../chapter-24.xhtml#function-compile-file">compile-file</a> might be caught and turned into compiler warnings. <br/></section></div></main><footer>Copyright © 2021 Jan Moringen</footer></body></html>