<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN"
  "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="utf-8"/><link rel="stylesheet" type="text/css" href="../style.css"/><script src="../permalink.js"/><script src="../navigation.js"/><title>Well-specified Common Lisp — DO-SYMBOLS-DUPLICATES</title></head><body><main><nav class="sidebar"><span class="name">Entry Points</span><br/><ol><li><a href="../chap-0.xhtml#section-Figures">Table of Contents</a></li><li><a href="../symbol-index.xhtml#section-SymbolIndex">Symbol Index</a></li><li><a href="../figure-index.xhtml#section-FigureIndex">Figure Index</a></li><li><a href="../issue-index.xhtml#section-IssueIndices">Issue Index</a></li><li><a href="../note-indices.xhtml#section-ReviewerNoteIndex">Note Indices</a></li><li><a href="../chapter-26.xhtml#section-Glossary">Glossary</a></li></ol><hr/><span class="name">DO-SYMBOLS-DUPLICATES</span><br/><ol class="local-toc"><li><a href="#section-Status">Status</a><ol> </ol></li><li><a href="#section-References">References</a><ol> </ol></li><li><a href="#section-Edit history">Edit history</a><ol> </ol></li><li><a href="#section-Problem Description">Problem Description</a><ol> </ol></li><li><a href="#issue-do-symbols-duplicates:allowed">Proposal ALLOWED</a><ol> </ol></li><li><a href="#section-Example">Example</a><ol> </ol></li><li><a href="#section-Rationale">Rationale</a><ol> </ol></li><li><a href="#section-Current Practice">Current Practice</a><ol> </ol></li><li><a href="#section-Cost to implementors">Cost to implementors</a><ol> </ol></li><li><a href="#section-Cost to users">Cost to users</a><ol> </ol></li><li><a href="#section-Benefits">Benefits</a><ol> </ol></li><li><a href="#section-Aesthetics">Aesthetics</a><ol> </ol></li><li><a href="#section-Discussion">Discussion</a><ol> </ol></li></ol></nav><div class="content"><h1>X3J13 Issue DO-SYMBOLS-DUPLICATES [NIL] [Clarification]</h1><section id="section-Status" class="status-passed section"><h2 class="section-title">Status</h2>passed, 1988? (not sure which meeting) </section><section id="section-References" class="section"><h2 class="section-title">References</h2><a class="macro-reference" href="../chapter-11.xhtml#macro-do-symbols">do-symbols</a>, CLtL p.187 </section><section id="section-Edit history" class="section"><h2 class="section-title">Edit history</h2>Version 1 by Fahlman 17-Apr-87 Version 2 by Masinter 29-May-87 Version 3 by Masinter 23-Nov-87 </section><section id="section-Problem Description" class="section"><h2 class="section-title">Problem Description</h2>CLtL specifies that <a class="macro-reference" href="../chapter-11.xhtml#macro-do-symbols">do-symbols</a> executes the body once for each symbol accessible in the package.  It does not say whether it is permissible for the body to be executed more than once for some accessible symbols. The term "accessible" is defined on page 172 to include symbols inherited from other packages <pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-5.xhtml#function-not">not</a> <span class="syntax-interned-symbol">including</span> <span class="syntax-interned-symbol">any</span> <span class="syntax-interned-symbol">symbols</span> <span class="syntax-interned-symbol">that</span> <span class="syntax-interned-symbol">may</span> <span class="syntax-interned-symbol">be</span> <span class="syntax-interned-symbol">shadowed</span>)</span>
</span></code></pre>.  It is very expensive in some implementations to eliminate duplications that occur because the same symbol is inherited from multiple packages. <br/></section><section class="status-passed proposal" id="issue-do-symbols-duplicates:allowed"><h2 class="section-title">Proposal ALLOWED</h2>Add to the specification of <a class="macro-reference" href="../chapter-11.xhtml#macro-do-symbols">do-symbols</a> a note that it may execute the body more than once for some symbols. <br/></section><section id="section-Example" class="section"><h2 class="section-title">Example</h2><pre><pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="special-operator-reference" href="../chapter-5.xhtml#special-operator-setq">setq</a> <span class="syntax-interned-symbol">A</span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-make-package">make-package</a> <span class="syntax-quote">'<span class="syntax-interned-symbol">A</span></span>)</span>)</span>
</span></code></pre><br/><pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="special-operator-reference" href="../chapter-5.xhtml#special-operator-setq">setq</a> <span class="syntax-interned-symbol">B</span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-make-package">make-package</a> <span class="syntax-quote">'<span class="syntax-interned-symbol">B</span></span>)</span>)</span>
</span></code></pre><br/><pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-export">export</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-intern">intern</a> <span class="syntax-string">"ASYM"</span> <span class="syntax-interned-symbol">A</span>)</span> <span class="syntax-interned-symbol">A</span>)</span>
</span></code></pre><br/><pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-use-package">use-package</a> <span class="syntax-interned-symbol">A</span> <span class="syntax-interned-symbol">B</span>)</span>
</span></code></pre><br/><pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-export">export</a> <span class="syntax-quote">'<span class="syntax-two-package-markers syntax-interned-symbol">B::ASYM</span></span> <span class="syntax-interned-symbol">B</span>)</span>
</span></code></pre><br/><pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-use-package">use-package</a> <span class="syntax-interned-symbol">B</span> <span class="syntax-interned-symbol">A</span>)</span>
</span></code></pre><br/><pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-11.xhtml#macro-do-symbols">do-symbols</a> <span class="syntax-cons">(<span class="syntax-interned-symbol">X</span> <span class="syntax-interned-symbol">B</span>)</span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-22.xhtml#function-print">print</a> <span class="syntax-interned-symbol">X</span>)</span>)</span>
</span></code></pre> <br/>;; this may print ASYM once or twice.<br/><br/></pre></section><section id="section-Rationale" class="section"><h2 class="section-title">Rationale</h2>Most uses of DO-PACKAGE would not be harmed by the presence of duplicates.  For these applications it is unreasonable to force users to pay the high cost of filtering out the duplications.  Users who really want the duplicates to be removed can add additional code to do this job. <br/></section><section id="section-Current Practice" class="section"><h2 class="section-title">Current Practice</h2>Many implementations have always produced duplicate values. <br/></section><section id="section-Cost to implementors" class="section"><h2 class="section-title">Cost to implementors</h2>None.  Implemenations would still be free to eliminate the duplications, though code will not be assuming that this has been done. <br/></section><section id="section-Cost to users" class="section"><h2 class="section-title">Cost to users</h2>Code written assuming that <a class="macro-reference" href="../chapter-11.xhtml#macro-do-symbols">do-symbols</a> eliminates duplications will have to be modified. (Such code was not truly portable.) <br/></section><section id="section-Benefits" class="section"><h2 class="section-title">Benefits</h2>Clarification of a situation that is currently ambiguous. <br/></section><section id="section-Aesthetics" class="section"><h2 class="section-title">Aesthetics</h2>It would be cleaner to present each symbol exactly once.  This is a clear case of choosing efficiency over elegance. <br/></section><section id="section-Discussion" class="section"><h2 class="section-title">Discussion</h2>This issue was discussed on the Common Lisp mailing list in 1985, and the solution proposed here seems to have been informally agreed to at the time &ndash; there was no formal decision-making process in place then. <br/>The need for <a class="macro-reference" href="../chapter-11.xhtml#macro-do-symbols">do-symbols</a> to be efficient is questionable, however; for many applications (e.g., global package manipulation), duplicate values would create havoc.  <br/>For some implementations, the performance penalty would be well over a factor of two. <br/>Several proposals were considered for adding keyword arguments to <a class="macro-reference" href="../chapter-11.xhtml#macro-do-symbols">do-symbols</a> which might specify :ALLOW-DUPLICATES, adding keywords and eliminating <a class="macro-reference" href="../chapter-11.xhtml#macro-do-external-symbols">do-external-symbols</a>, etc., but no clear consensus was reached for making additions. <br/>This version is the closest to the status quo. <br/></section></div></main><footer>Copyright © 2021 Jan Moringen</footer></body></html>