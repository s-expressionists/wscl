<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN"
  "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="utf-8"/><link rel="stylesheet" type="text/css" href="../style.css"/><script src="../permalink.js"/><script src="../navigation.js"/><title>Well-specified Common Lisp — COMPLEX-ATANH-BOGUS-FORMULA</title></head><body><main><nav class="sidebar"><span class="name">Entry Points</span><br/><ol><li><a href="../chap-0.xhtml#section-Figures">Table of Contents</a></li><li><a href="../symbol-index.xhtml#section-SymbolIndex">Symbol Index</a></li><li><a href="../figure-index.xhtml#section-FigureIndex">Figure Index</a></li><li><a href="../issue-index.xhtml#section-IssueIndices">Issue Index</a></li><li><a href="../note-indices.xhtml#section-ReviewerNoteIndex">Note Indices</a></li><li><a href="../chapter-26.xhtml#section-Glossary">Glossary</a></li></ol><hr/><span class="name">COMPLEX-ATANH-BOGUS-FORMULA</span><br/><ol class="local-toc"><li><a href="#section-Status">Status</a><ol> </ol></li><li><a href="#section-References">References</a><ol> </ol></li><li><a href="#section-Edit history">Edit history</a><ol> </ol></li><li><a href="#section-Problem description">Problem description</a><ol> </ol></li><li><a href="#issue-complex-atanh-branch-cut:tweak-more">Proposal TWEAK-MORE</a><ol> </ol></li><li><a href="#section-Rationale">Rationale</a><ol> </ol></li><li><a href="#section-Current practice">Current practice</a><ol> </ol></li><li><a href="#section-Cost to Implementors">Cost to Implementors</a><ol> </ol></li><li><a href="#section-Cost to Users">Cost to Users</a><ol> </ol></li><li><a href="#section-Cost of non-adoption">Cost of non-adoption</a><ol> </ol></li><li><a href="#section-Benefits">Benefits</a><ol> </ol></li><li><a href="#section-Esthetics">Esthetics</a><ol> </ol></li><li><a href="#section-Discussion">Discussion</a><ol> </ol></li></ol></nav><div class="content"><h1>X3J13 Issue COMPLEX-ATANH-BOGUS-FORMULA [Cleanup] [CHANGE]</h1><h2>Related issues</h2><ul><a class="issue-reference" href="../issues/complex-atan-branch-cut.xhtml#issue-complex-atan-branch-cut">COMPLEX-ATAN-BRANCH-CUT</a><a class="issue-reference" href="../issues/ieee-atan-branch-cut.xhtml#issue-ieee-atan-branch-cut">IEEE-ATAN-BRANCH-CUT</a></ul><section id="section-Status" class="status-passed section"><h2 class="section-title">Status</h2>Passed, Nov 89 X3J13 </section><section id="section-References" class="section"><h2 class="section-title">References</h2>CLtL pp. 209, 212, 213 Penfield, P. "Principal Values and Branch Cuts in Complex APL", Proc. APL 81 Conference Proceedings, Association for Computing Machinery, 1981 Kahan, W. "Branch Cuts for Complex Elementary Functions, or Much Ado About Nothing's Sign Bit" in Iserles and Powell (eds.) "The State of the Art in Numerical Analysis", pp. 165-211, Clarendon Press, 1987 </section><section id="section-Edit history" class="section"><h2 class="section-title">Edit history</h2>Version 1, 20-SEP-89, Steele <br/></section><section id="section-Problem description" class="section"><h2 class="section-title">Problem description</h2>The formula that defines <a class="function-reference" href="../chapter-12.xhtml#function-atanh">atanh</a> in CLtL is incorrect, apparently because of a mistranscription of a formula from Penfield's article. <br/>CLtL has:   arctanh z <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a> log <code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-cons">(<span class="syntax-interned-symbol">1+z</span>)</span> <a class="function-reference" href="../chapter-12.xhtml#function-sqrt">sqrt</a><span class="syntax-cons">(<span class="syntax-number">1</span> <a class="function-reference" href="../chapter-12.xhtml#function--">-</a> <span class="syntax-cons">(<span class="syntax-number">1</span> <a class="function-reference" href="../chapter-12.xhtml#function-/">/</a> <span class="syntax-interned-symbol">z^2</span>)</span>)</span>)</span>
</span></code> <br/>Should be:  arctanh z <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a> log <code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-cons">(<span class="syntax-interned-symbol">1+z</span>)</span> <a class="function-reference" href="../chapter-12.xhtml#function-sqrt">sqrt</a><span class="syntax-cons">(<span class="syntax-number">1</span> <a class="function-reference" href="../chapter-12.xhtml#function-/">/</a> <span class="syntax-cons">(<span class="syntax-number">1</span> <a class="function-reference" href="../chapter-12.xhtml#function--">-</a> <span class="syntax-interned-symbol">z^2</span>)</span>)</span>)</span>
</span></code> <br/>However, given the change to <a class="function-reference" href="../chapter-12.xhtml#function-atan">atan</a> in <a class="issue-reference" href="../issues/complex-atan-branch-cut.xhtml#issue-complex-atan-branch-cut">X3J13 Issue COMPLEX-ATAN-BRANCH-CUT</a>, it seems simpler to follow Kahan's recommendation and define <br/>	arctanh z <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a> <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-log">log</a><span class="syntax-cons">(<span class="syntax-interned-symbol">1+z</span>)</span> <a class="function-reference" href="../chapter-12.xhtml#function--">-</a> <a class="function-reference" href="../chapter-12.xhtml#function-log">log</a><span class="syntax-cons">(<span class="syntax-interned-symbol">1-z</span>)</span>)</span>
</span></code>/2 <br/>thereby preserving the identity  i arctan z <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a> arctanh iz . <br/>Kahan also notes that Penfield's formula for arccosh (CLtL p. 213) <br/>	arccosh z <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a> log<code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">z</span> <a class="function-reference" href="../chapter-12.xhtml#function-+">+</a> <span class="syntax-cons">(<span class="syntax-interned-symbol">z</span> <a class="function-reference" href="../chapter-12.xhtml#function-+">+</a> <span class="syntax-number">1</span>)</span> <a class="function-reference" href="../chapter-12.xhtml#function-sqrt">sqrt</a><span class="syntax-cons">(<span class="syntax-cons">(<span class="syntax-interned-symbol">z-1</span>)</span><a class="function-reference" href="../chapter-12.xhtml#function-/">/</a><span class="syntax-cons">(<span class="syntax-interned-symbol">z+1</span>)</span>)</span>)</span>
</span></code> <br/>has a gratuitous removable singularity at z=-1 and recommends <br/>	arccosh z <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a> 2 log<code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-sqrt">sqrt</a><span class="syntax-cons">(<span class="syntax-cons">(<span class="syntax-interned-symbol">z+1</span>)</span><span class="syntax-interned-symbol">/2</span>)</span> <a class="function-reference" href="../chapter-12.xhtml#function-+">+</a> <a class="function-reference" href="../chapter-12.xhtml#function-sqrt">sqrt</a><span class="syntax-cons">(<span class="syntax-cons">(<span class="syntax-interned-symbol">z-1</span>)</span><span class="syntax-interned-symbol">/2</span>)</span>)</span>
</span></code> <br/>which has the same values and is also well-defined at z=-1. <br/>Finally, Kahan recommends a different defining formula for acos that is more similar to that of acosh <pre><code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">but</span> <span class="syntax-interned-symbol">less</span> <span class="syntax-interned-symbol">similar</span> <span class="syntax-interned-symbol">to</span> <span class="syntax-interned-symbol">that</span>
<span class="syntax-interned-symbol">of</span> <a class="function-reference" href="../chapter-12.xhtml#function-asin">asin</a>)</span>
</span></code></pre>. <br/></section><section class="status-passed proposal" id="issue-complex-atanh-branch-cut:tweak-more"><h2 class="section-title">Proposal TWEAK-MORE</h2><ol><li> Replace the erroneous formula 	arctanh z <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a> log <code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-cons">(<span class="syntax-interned-symbol">1+z</span>)</span> <a class="function-reference" href="../chapter-12.xhtml#function-sqrt">sqrt</a><span class="syntax-cons">(<span class="syntax-number">1</span> <a class="function-reference" href="../chapter-12.xhtml#function--">-</a> <span class="syntax-cons">(<span class="syntax-number">1</span> <a class="function-reference" href="../chapter-12.xhtml#function-/">/</a> <span class="syntax-interned-symbol">z^2</span>)</span>)</span>)</span>
</span></code> with 	arctanh z <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a> <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-log">log</a><span class="syntax-cons">(<span class="syntax-interned-symbol">1+z</span>)</span> <a class="function-reference" href="../chapter-12.xhtml#function--">-</a> <a class="function-reference" href="../chapter-12.xhtml#function-log">log</a><span class="syntax-cons">(<span class="syntax-interned-symbol">1-z</span>)</span>)</span>
</span></code>/2 <br/></li><li> Note that  i arctan z <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a> arctanh iz . </li><li> Replace the gratuitously singular formula 	arccosh z <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a> log<code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">z</span> <a class="function-reference" href="../chapter-12.xhtml#function-+">+</a> <span class="syntax-cons">(<span class="syntax-interned-symbol">z</span> <a class="function-reference" href="../chapter-12.xhtml#function-+">+</a> <span class="syntax-number">1</span>)</span> <a class="function-reference" href="../chapter-12.xhtml#function-sqrt">sqrt</a><span class="syntax-cons">(<span class="syntax-cons">(<span class="syntax-interned-symbol">z-1</span>)</span><a class="function-reference" href="../chapter-12.xhtml#function-/">/</a><span class="syntax-cons">(<span class="syntax-interned-symbol">z+1</span>)</span>)</span>)</span>
</span></code> with 	arccosh z <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a> 2 log<code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-sqrt">sqrt</a><span class="syntax-cons">(<span class="syntax-cons">(<span class="syntax-interned-symbol">z+1</span>)</span><span class="syntax-interned-symbol">/2</span>)</span> <a class="function-reference" href="../chapter-12.xhtml#function-+">+</a> <a class="function-reference" href="../chapter-12.xhtml#function-sqrt">sqrt</a><span class="syntax-cons">(<span class="syntax-cons">(<span class="syntax-interned-symbol">z-1</span>)</span><span class="syntax-interned-symbol">/2</span>)</span>)</span>
</span></code> <br/></li><li> Adopt the formula (already in CLtL) 	arccos z <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a> <code><span class="syntax-root"><span class="syntax-cons">(<a class="constant-reference" href="../chapter-12.xhtml#constant-pi">pi</a> <a class="function-reference" href="../chapter-12.xhtml#function-/">/</a> <span class="syntax-number">2</span>)</span>
</span></code> <a class="function-reference" href="../chapter-12.xhtml#function--">-</a> arcsin z <br/>as the official definition of arccos, and also note that the formulas <br/>	arccos z <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a> -i log<code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">z</span> <a class="function-reference" href="../chapter-12.xhtml#function-+">+</a> <span class="syntax-interned-symbol">i</span> <a class="function-reference" href="../chapter-12.xhtml#function-sqrt">sqrt</a><span class="syntax-cons">(<span class="syntax-number">1</span> <a class="function-reference" href="../chapter-12.xhtml#function--">-</a> <span class="syntax-interned-symbol">z^2</span>)</span>)</span>
</span></code> <br/>(already in CLtL) and <br/>	arccos z <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a> 2 log<code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-sqrt">sqrt</a><span class="syntax-cons">(<span class="syntax-cons">(<span class="syntax-interned-symbol">1+z</span>)</span><span class="syntax-interned-symbol">/2</span>)</span> <a class="function-reference" href="../chapter-12.xhtml#function-+">+</a> <span class="syntax-interned-symbol">i</span> <a class="function-reference" href="../chapter-12.xhtml#function-sqrt">sqrt</a><span class="syntax-cons">(<span class="syntax-cons">(<span class="syntax-interned-symbol">1-z</span>)</span><span class="syntax-interned-symbol">/2</span>)</span>)</span>
</span></code> <a class="function-reference" href="../chapter-12.xhtml#function-/">/</a> i <br/>(recommended by Kahan) are equivalent. <br/><br/></li></ol></section><section id="section-Rationale" class="section"><h2 class="section-title">Rationale</h2>Compatibility with what seems to be becoming standard practice. <br/>   </section><section id="section-Current practice" class="section"><h2 class="section-title">Current practice</h2>Implementations I have checked have a correct implementation of <a class="function-reference" href="../chapter-12.xhtml#function-atanh">atanh</a> rather than slavishly following the bogus CLtL formula. <br/></section><section id="section-Cost to Implementors" class="section"><h2 class="section-title">Cost to Implementors</h2><a class="function-reference" href="../chapter-12.xhtml#function-atanh">atanh</a> must be rewritten.  It is not a very difficult fix. <br/>Possibly <a class="function-reference" href="../chapter-12.xhtml#function-acosh">acosh</a> must be rewritten.  It is not a very difficult fix. <br/></section><section id="section-Cost to Users" class="section"><h2 class="section-title">Cost to Users</h2>The compatibility note on p. 210 of CLtL gave users fair warning that a change of this kind might be adopted. <br/></section><section id="section-Cost of non-adoption" class="section"><h2 class="section-title">Cost of non-adoption</h2>Possible incorrect implementations of <a class="function-reference" href="../chapter-12.xhtml#function-atanh">atanh</a>. <br/>Incompatibility with HP calculators. <br/></section><section id="section-Benefits" class="section"><h2 class="section-title">Benefits</h2>Numerical analysts may find the new definition easier to use. <br/></section><section id="section-Esthetics" class="section"><h2 class="section-title">Esthetics</h2>A toss-up, except to those who care. <br/></section><section id="section-Discussion" class="section"><h2 class="section-title">Discussion</h2>Kahan's article not only discussed formulas but also gives specific implementation techniques for use with IEEE 754 arithmetic. <br/> </section></div></main><footer>Copyright © 2021 Jan Moringen</footer></body></html>