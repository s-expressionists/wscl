<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN"
  "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="utf-8"/><link rel="stylesheet" type="text/css" href="../style.css"/><script src="../permalink.js"/><script src="../navigation.js"/><title>Well-specified Common Lisp — MACROEXPAND-RETURN-VALUE</title></head><body><main><nav class="sidebar"><span class="name">Entry Points</span><br/><ol><li><a href="../chap-0.xhtml#section-Figures">Table of Contents</a></li><li><a href="../symbol-index.xhtml#section-SymbolIndex">Symbol Index</a></li><li><a href="../figure-index.xhtml#section-FigureIndex">Figure Index</a></li><li><a href="../issue-index.xhtml#section-IssueIndices">Issue Index</a></li><li><a href="../note-indices.xhtml#section-ReviewerNoteIndex">Note Indices</a></li><li><a href="../chapter-26.xhtml#section-Glossary">Glossary</a></li></ol><hr/><span class="name">MACROEXPAND-RETURN-VALUE</span><br/><ol class="local-toc"><li><a href="#section-References">References</a><ol> </ol></li><li><a href="#section-Edit History">Edit History</a><ol> </ol></li><li><a href="#section-Problem Description">Problem Description</a><ol> </ol></li><li><a href="#issue-macroexpand-return-value:true">Proposal TRUE</a><ol> </ol></li><li><a href="#section-Rationale">Rationale</a><ol> </ol></li><li><a href="#section-Current Practice">Current Practice</a><ol> </ol></li><li><a href="#section-Cost to implementors">Cost to implementors</a><ol> </ol></li><li><a href="#section-Cost to users">Cost to users</a><ol> </ol></li><li><a href="#section-Benefits">Benefits</a><ol> </ol></li><li><a href="#section-Discussion">Discussion</a><ol> </ol></li></ol></nav><div class="content"><h1>X3J13 Issue MACROEXPAND-RETURN-VALUE [Cleanup] [CHANGE]</h1><section id="section-References" class="section"><h2 class="section-title">References</h2><a class="function-reference" href="../chapter-3.xhtml#function-macroexpand">MACROEXPAND</a>, <a class="function-reference" href="../chapter-3.xhtml#function-macroexpand-1">MACROEXPAND-1</a> (CLtL p151) COMPILER-MACROEXPAND, COMPILER-MACROEXPAND-1 (<a class="issue-reference" href="../issues/define-compiler-macro.xhtml#issue-define-compiler-macro">X3J13 Issue DEFINE-COMPILER-MACRO</a>) </section><section id="section-Edit History" class="section"><h2 class="section-title">Edit History</h2>V1, 29 Oct 1989, Sandra Loosemore <br/></section><section id="section-Problem Description" class="section"><h2 class="section-title">Problem Description</h2>CLtL says that the second value returned by <a class="function-reference" href="../chapter-3.xhtml#function-macroexpand">MACROEXPAND</a> and <a class="function-reference" href="../chapter-3.xhtml#function-macroexpand-1">MACROEXPAND-1</a> is <a class="section-reference" href="../chapter-26.xhtml#section-T">T</a> if the argument form is a macro call.  Presumably this is also the case for COMPILER-MACROEXPAND and COMPILER-MACROEXPAND-1, since these functions are intended to be "just like" their counterparts.  Specifying a return value of <a class="section-reference" href="../chapter-26.xhtml#section-T">T</a> is inconsistent with other predicates in the language, where a return value of "true" is normally specified instead. <br/></section><section class="status-unknown proposal" id="issue-macroexpand-return-value:true"><h2 class="section-title">Proposal TRUE</h2>Change the specification so that the second return value from <a class="function-reference" href="../chapter-3.xhtml#function-macroexpand">MACROEXPAND</a>, <a class="function-reference" href="../chapter-3.xhtml#function-macroexpand-1">MACROEXPAND-1</a>, COMPILER-MACROEXPAND, and COMPILER-MACROEXPAND-1 is a boolean instead of one of the symbols <a class="section-reference" href="../chapter-26.xhtml#section-T">T</a> or <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a>.  In other words, if the form represents a macro call (or a compiler macro call, as appropriate), the second return value is true. <br/></section><section id="section-Rationale" class="section"><h2 class="section-title">Rationale</h2>This is more consistent with other predicates in the language. <br/></section><section id="section-Current Practice" class="section"><h2 class="section-title">Current Practice</h2>Presumably all conforming implementations now return <a class="section-reference" href="../chapter-26.xhtml#section-T">T</a>. <br/></section><section id="section-Cost to implementors" class="section"><h2 class="section-title">Cost to implementors</h2>None, except possibly for the cost of changing documentation. <br/></section><section id="section-Cost to users" class="section"><h2 class="section-title">Cost to users</h2>It seems unlikely that user programs would explicitly test for the return value being <a class="section-reference" href="../chapter-26.xhtml#section-T">T</a>, or otherwise depend on this. <br/></section><section id="section-Benefits" class="section"><h2 class="section-title">Benefits</h2>Increased consistency in the language design. <br/></section><section id="section-Discussion" class="section"><h2 class="section-title">Discussion</h2>Loosemore notes:   In some implementations, there is a slight performance advantage in   allowing the return values from predicates to be any <a class="glossary-reference" href="../chapter-26.xhtml#glossary-non-nil">non-nil</a> value   instead of the symbol <a class="section-reference" href="../chapter-26.xhtml#section-T">T</a>.  Some functions such as <a class="function-reference" href="../chapter-14.xhtml#function-member">MEMBER</a> are required   to return a particular truth value that conveys extra information back   to the caller, but there doesn't appear to be similar motivation for   making an exception to the general rule in this situation. </section></div></main><footer>Copyright © 2021 Jan Moringen</footer></body></html>