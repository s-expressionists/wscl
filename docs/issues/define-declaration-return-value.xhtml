<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN"
  "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="utf-8"/><link rel="stylesheet" type="text/css" href="../style.css"/><script src="../permalink.js"/><script src="../navigation.js"/><title>Well-specified Common Lisp — DEFINE-DECLARATION-RETURN-VALUE</title></head><body><main><nav class="sidebar"><span class="name">Entry Points</span><br/><ol><li><a href="../chap-0.xhtml#section-Figures">Table of Contents</a></li><li><a href="../symbol-index.xhtml#section-SymbolIndex">Symbol Index</a></li><li><a href="../figure-index.xhtml#section-FigureIndex">Figure Index</a></li><li><a href="../issue-index.xhtml#section-IssueIndices">Issue Index</a></li><li><a href="../note-indices.xhtml#section-ReviewerNoteIndex">Note Indices</a></li><li><a href="../chapter-26.xhtml#section-Glossary">Glossary</a></li></ol><hr/><span class="name">DEFINE-DECLARATION-RETURN-VALUE</span><br/><ol class="local-toc"><li><a href="#section-References">References</a><ol> </ol></li><li><a href="#section-Edit History">Edit History</a><ol> </ol></li><li><a href="#section-Problem Description">Problem Description</a><ol> </ol></li><li><a href="#issue-define-declaration-return-value:three-values">Proposal THREE-VALUES</a><ol> </ol></li><li><a href="#section-Rationale">Rationale</a><ol> </ol></li><li><a href="#section-Current Practice">Current Practice</a><ol> </ol></li><li><a href="#section-Cost to implementors">Cost to implementors</a><ol> </ol></li><li><a href="#section-Cost to users">Cost to users</a><ol> </ol></li><li><a href="#section-Benefits">Benefits</a><ol> </ol></li><li><a href="#section-Discussion">Discussion</a><ol> </ol></li></ol></nav><div class="content"><h1>X3J13 Issue DEFINE-DECLARATION-RETURN-VALUE [Cleanup] [CHANGE]</h1><section id="section-References" class="section"><h2 class="section-title">References</h2>DEFINE-DECLARATION (<span class="issue-reference error">issue:Issue SYNTACTIC-ENVIRONMENT-ACCESS</span>) </section><section id="section-Edit History" class="section"><h2 class="section-title">Edit History</h2>V1, 29 Oct 1989, Sandra Loosemore <br/></section><section id="section-Problem Description" class="section"><h2 class="section-title">Problem Description</h2>The specification of the return values from handlers defined with DEFINE-DECLARATION (added to the language at the June 89 meeting) only permits a declaration to apply either to variable bindings, to function bindings, or to neither.  The first return value from the handler function indicates which of these cases it is, and the second return value is a list containing information about the declaration. <br/>The <a class="declaration-reference" href="../chapter-3.xhtml#declaration-dynamic-extent">dynamic-extent</a> declaration cannot be handled with this mechanism since it can apply to both variable and function bindings.  It seems reasonable for both users and implementations to define other kinds of declarations that use a similar syntax, and DEFINE-DECLARATION ought to be able to handle these cases. <br/></section><section class="status-unknown proposal" id="issue-define-declaration-return-value:three-values"><h2 class="section-title">Proposal THREE-VALUES</h2>Change the specification of DEFINE-DECLARATION to require handler functions to return three values. <br/>The first value is a list which corresponds to information about variable bindings specified by the declaration.  The format of this list is the same as is now required to be returned as the second value of DEFINE-DECLARATION when the first value is :VARIABLE; that is, a list of <pre><code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">binding-name</span> <span class="syntax-interned-symbol">key</span> <span class="syntax-interned-symbol">value</span>)</span>
</span></code></pre> lists. <br/>The second value is a list which corresponds to information about function bindings specified by the declaration.  The format of this list is the same as is now required to be returned as the second value of DEFINE-DECLARATION when the first value is :FUNCTION; that is, a list of <pre><code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">binding-name</span> <span class="syntax-interned-symbol">key</span> <span class="syntax-interned-symbol">value</span>)</span>
</span></code></pre> lists. <br/>The third value is a list which corresponds to information about declarations that do not apply to either variable or function bindings.  The format of this list is the same as is now required to be returned as the second value of DEFINE-DECLARATION when the first value is :DECLARE; that is, a list whose <a class="function-reference" href="../chapter-14.xhtml#function-car">car</a> is a key <pre><code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">used</span> <span class="syntax-interned-symbol">by</span> <a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">the</a>
<a class="special-operator-reference" href="../chapter-5.xhtml#special-operator-function">function</a> <span class="syntax-interned-symbol">DECLARATION-INFORMATION</span>)</span>
</span></code></pre> and whose <a class="function-reference" href="../chapter-14.xhtml#function-cdr">cdr</a> is the associated return value. <br/></section><section id="section-Rationale" class="section"><h2 class="section-title">Rationale</h2>This proposal fixes a deficiency in the original specification of  DEFINE-DECLARATION, while minimizing the change to the format of the information that is returned. <br/></section><section id="section-Current Practice" class="section"><h2 class="section-title">Current Practice</h2>Has anybody even implemented DEFINE-DECLARATION <pre><code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">as</span> <span class="syntax-interned-symbol">originally</span>
<span class="syntax-interned-symbol">specified</span> <span class="syntax-interned-symbol">in</span> <span class="syntax-interned-symbol">issue</span> <span class="syntax-interned-symbol">SYNTACTIC-ENVIRONMENT-ACCESS</span>)</span>
</span></code></pre> yet? <br/></section><section id="section-Cost to implementors" class="section"><h2 class="section-title">Cost to implementors</h2>Probably minor. <br/></section><section id="section-Cost to users" class="section"><h2 class="section-title">Cost to users</h2>Probably minor. <br/></section><section id="section-Benefits" class="section"><h2 class="section-title">Benefits</h2>DEFINE-DECLARATION is made more powerful. <br/></section><section id="section-Discussion" class="section"><h2 class="section-title">Discussion</h2></section></div></main><footer>Copyright © 2021 Jan Moringen</footer></body></html>