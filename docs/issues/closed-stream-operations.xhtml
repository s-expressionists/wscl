<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN"
  "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="utf-8"/><link rel="stylesheet" type="text/css" href="../style.css"/><script src="../permalink.js"/><script src="../navigation.js"/><title>Well-specified Common Lisp — CLOSED-STREAM-OPERATIONS</title></head><body><main><nav class="sidebar"><span class="name">Entry Points</span><br/><ol><li><a href="../chap-0.xhtml#section-Figures">Table of Contents</a></li><li><a href="../symbol-index.xhtml#section-SymbolIndex">Symbol Index</a></li><li><a href="../figure-index.xhtml#section-FigureIndex">Figure Index</a></li><li><a href="../issue-index.xhtml#section-IssueIndices">Issue Index</a></li><li><a href="../note-indices.xhtml#section-ReviewerNoteIndex">Note Indices</a></li><li><a href="../chapter-26.xhtml#section-Glossary">Glossary</a></li></ol><hr/><span class="name">CLOSED-STREAM-OPERATIONS</span><br/><ol class="local-toc"><li><a href="#section-Status">Status</a><ol> </ol></li><li><a href="#section-References">References</a><ol> </ol></li><li><a href="#section-Edit history">Edit history</a><ol> </ol></li><li><a href="#section-Problem Description">Problem Description</a><ol> </ol></li><li><a href="#issue-closed-stream-functions:allow-inquiry">Proposal ALLOW-INQUIRY</a><ol> </ol></li><li><a href="#section-Rationale">Rationale</a><ol> </ol></li><li><a href="#section-Current Practice">Current Practice</a><ol> </ol></li><li><a href="#section-Cost to Implementors">Cost to Implementors</a><ol> </ol></li><li><a href="#section-Cost to Users">Cost to Users</a><ol> </ol></li><li><a href="#section-Benefits">Benefits</a><ol> </ol></li><li><a href="#section-Aesthetics">Aesthetics</a><ol> </ol></li><li><a href="#section-Discussion">Discussion</a><ol> </ol></li></ol></nav><div class="content"><h1>X3J13 Issue CLOSED-STREAM-OPERATIONS [Cleanup] [CLARIFICATION]</h1><h2>Related issues</h2><ul><li><a class="issue-reference" href="../issues/stream-access.xhtml#issue-stream-access">STREAM-ACCESS</a></li><li><span class="issue-reference error">issue:STREAM-INFO</span></li><li><span class="issue-reference error">issue:INPUT-STREAM-P-CLOSED</span></li><li><a class="issue-reference" href="../issues/close-constructed-stream.xhtml#issue-close-constructed-stream">CLOSE-CONSTRUCTED-STREAMS</a></li><li><a class="issue-reference" href="../issues/pathname-stream.xhtml#issue-pathname-stream">PATHNAME-STREAM</a></li></ul><section id="section-Status" class="status-passed section"><h2 class="section-title">Status</h2>Passed Jan 89 X3J13 with amendment to specify that <a class="function-reference" href="../chapter-21.xhtml#function-close">CLOSE</a> on a closed stream returns <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a>. At Mar 89 X3J13, amendment was withdrawn; this version stands. </section><section id="section-References" class="section"><h2 class="section-title">References</h2><a class="function-reference" href="../chapter-21.xhtml#function-close">CLOSE</a> (CLtL p 332) </section><section id="section-Edit history" class="section"><h2 class="section-title">Edit history</h2>26-Aug-88, Version 1 by Chapman 8-Oct-88, Version 2 by Masinter 13-Oct-88, Version 3 by van Roggen 1-Dec-88, Version 4 by Pitman 5-Dec-88, Version 5 by Masinter (separate other issues) </section><section id="section-Problem Description" class="section"><h2 class="section-title">Problem Description</h2> The description of <a class="function-reference" href="../chapter-21.xhtml#function-close">CLOSE</a> is not completely clear about the functions  which are allowed to be performed on a closed stream. <br/> On p332 it says: <br/>  ``The stream is closed. No further Input/output operations may be     performed on it. However, certain inquiry operations may still     be performed, ...'' <br/>  but the list of inquiry operations is not specified. <br/></section><section class="status-passed proposal" id="issue-closed-stream-functions:allow-inquiry"><h2 class="section-title">Proposal ALLOW-INQUIRY</h2> Clarify the behavior of the following functions on closed streams: <br/>  * <a class="function-reference" href="../chapter-21.xhtml#function-streamp">STREAMP</a> is unaffected by whether its stream argument is open or closed. <br/>  * If <a class="function-reference" href="../chapter-21.xhtml#function-close">CLOSE</a> is called on a stream which is open, it will return <a class="section-reference" href="../chapter-26.xhtml#section-T">T</a>.     However, if <a class="function-reference" href="../chapter-21.xhtml#function-close">CLOSE</a> is called on a stream which is closed, it     will succeed without error but the return value is not specified. <br/>  * <a class="function-reference" href="../chapter-19.xhtml#function-pathname">PATHNAME</a> is valid on either an open or closed stream. Since some     implementations cannot provide the truename of a file until the     file is closed, it would in principle be possible for <a class="function-reference" href="../chapter-19.xhtml#function-pathname">PATHNAME</a> in     some implementations to return more specific information after the     stream is closed. For consistency, however, <a class="function-reference" href="../chapter-19.xhtml#function-pathname">PATHNAME</a> is prohibited     from doing this. <a class="function-reference" href="../chapter-19.xhtml#function-pathname">PATHNAME</a> must return the same pathname after a     file is closed as it did before. (The passed proposal in issue     <a class="issue-reference" href="../issues/pathname-stream.xhtml#issue-pathname-stream">PATHNAME-STREAM</a> still stands.) <br/>  * <a class="function-reference" href="../chapter-20.xhtml#function-truename">TRUENAME</a> is valid on either an open or closed stream. Since some     implementations cannot provide the truename of a file until the     file is closed, it is permissible <a class="function-reference" href="../chapter-20.xhtml#function-truename">TRUENAME</a> to return more specific     information after the stream is closed. <br/>  * <a class="function-reference" href="../chapter-19.xhtml#function-merge-pathnames">MERGE-PATHNAMES</a>, <a class="function-reference" href="../chapter-19.xhtml#function-pathname-host">PATHNAME-HOST</a>, <a class="function-reference" href="../chapter-19.xhtml#function-pathname-device">PATHNAME-DEVICE</a>, <a class="function-reference" href="../chapter-19.xhtml#function-pathname-directory">PATHNAME-DIRECTORY</a>,     <a class="function-reference" href="../chapter-19.xhtml#function-pathname-name">PATHNAME-NAME</a>, <a class="function-reference" href="../chapter-19.xhtml#function-pathname-type">PATHNAME-TYPE</a>, <a class="function-reference" href="../chapter-19.xhtml#function-pathname-version">PATHNAME-VERSION</a>, <a class="function-reference" href="../chapter-19.xhtml#function-namestring">NAMESTRING</a>,      <a class="function-reference" href="../chapter-19.xhtml#function-file-namestring">FILE-NAMESTRING</a>, <a class="function-reference" href="../chapter-19.xhtml#function-directory-namestring">DIRECTORY-NAMESTRING</a>, <a class="function-reference" href="../chapter-19.xhtml#function-host-namestring">HOST-NAMESTRING</a>,      <a class="function-reference" href="../chapter-19.xhtml#function-enough-namestring">ENOUGH-NAMESTRING</a>, and <a class="function-reference" href="../chapter-21.xhtml#function-open">OPEN</a> are valid on either open or closed streams.     For any of these operations, using a stream, S, as an argument      where appropriate is equivalent to using <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-19.xhtml#function-pathname">PATHNAME</a> <span class="syntax-interned-symbol">s</span>)</span>
</span></code>. See the     description of <a class="function-reference" href="../chapter-19.xhtml#function-pathname">PATHNAME</a> above to understand the consequences of this. <br/>  * <a class="function-reference" href="../chapter-20.xhtml#function-probe-file">PROBE-FILE</a> and <a class="function-reference" href="../chapter-20.xhtml#function-directory">DIRECTORY</a> are valid on either open or closed streams.     For either of these operations, using a stream, S, as an argument      where appropriate is equivalent to using <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-19.xhtml#function-pathname">PATHNAME</a> <span class="syntax-interned-symbol">s</span>)</span>
</span></code>. See the     description of <a class="function-reference" href="../chapter-19.xhtml#function-pathname">PATHNAME</a> above to understand the consequences of this.     In this case of these operators however, closed stream may well be the     most reliable arguments in some cases, since treatment of open streams     to the file system may vary considerably between implementations.     For example, in some operating systems, open files are written under     temporary names and not renamed until close and/or are held invisible     until a close is performed. In general, any code with an intent to be     highly portable should tread lightly when using <a class="function-reference" href="../chapter-20.xhtml#function-probe-file">PROBE-FILE</a> or     <a class="function-reference" href="../chapter-20.xhtml#function-directory">DIRECTORY</a>. <br/></section><section id="section-Rationale" class="section"><h2 class="section-title">Rationale</h2> One can consider many characteristics of a stream to be independent of  the ability to do I/O.  Being able to determine a stream's direction and  its name is often useful for debugging.  A number of the descriptions in  CLtL imply <code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">weakly</span>)</span>
</span></code> the ability to work on closed streams.  Functions  such as <a class="function-reference" href="../chapter-21.xhtml#function-open">OPEN</a> and <a class="function-reference" href="../chapter-20.xhtml#function-directory">DIRECTORY</a> don't really depend on the stream, but on  the name of the stream. <br/></section><section id="section-Current Practice" class="section"><h2 class="section-title">Current Practice</h2> At least two implementations differ in which functions are allowed to be  performed on a closed stream. <br/></section><section id="section-Cost to Implementors" class="section"><h2 class="section-title">Cost to Implementors</h2> Unknown, but likely to be small in most implementations. <br/> A nontrivial amount of work may be necessary if the pathname information  is held  externally and is normally deleted when the stream is closed.   The implementation will have to copy the information at some time for later  inquiries. <br/></section><section id="section-Cost to Users" class="section"><h2 class="section-title">Cost to Users</h2> Likely to be small; users of an implementation forced to change  by this proposal might have to make some modifications to make their  programs portable. <br/></section><section id="section-Benefits" class="section"><h2 class="section-title">Benefits</h2> These clarifications will assist users in writing portable code. <br/></section><section id="section-Aesthetics" class="section"><h2 class="section-title">Aesthetics</h2> Most people will probably see these clarifications as an improvement  in aesthetics. <br/></section><section id="section-Discussion" class="section"><h2 class="section-title">Discussion</h2> There are some separate, but related, issues regarding what <a class="function-reference" href="../chapter-21.xhtml#function-close">CLOSE</a>  should do on composite streams or constructed streams such as  created by <a class="function-reference" href="../chapter-21.xhtml#function-make-broadcast-stream">MAKE-BROADCAST-STREAM</a>. These issues will be addressed  in a separate issue <code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">CLOSE-CONSTRUCTED-STREAMS</span>)</span>
</span></code>. <br/> There was some discussion on whether <a class="function-reference" href="../chapter-21.xhtml#function-input-stream-p">INPUT-STREAM-P</a> and <a class="function-reference" href="../chapter-21.xhtml#function-output-stream-p">OUTPUT-STREAM-P</a>  should return "false" on a stream that had been closed. The issue  <a class="issue-reference" href="../issues/stream-access.xhtml#issue-stream-access">STREAM-ACCESS</a> contains a proposal to add a function <a class="function-reference" href="../chapter-21.xhtml#function-open-stream-p">OPEN-STREAM-P</a>  which might be useful for the same purpose. This issue was separated  out into a separate issue <code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">INPUT-STREAM-P-CLOSED</span>)</span>
</span></code>. <br/> The other functions in proposal <span class="issue-reference error">issue:STREAM-ACCESS</span> should  work on closed streams. <br/> The functions in <span class="issue-reference error">issue:STREAM-INFO</span> should  not be required to work on closed streams. <br/><br/>     &mdash;&ndash; End Forwarded Messages &mdash;&ndash; </section></div></main><footer>Copyright © 2021 Jan Moringen</footer></body></html>