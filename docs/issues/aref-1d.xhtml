<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN"
  "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="utf-8"/><link rel="stylesheet" type="text/css" href="../style.css"/><script src="../permalink.js"/><script src="../navigation.js"/><title>Well-specified Common Lisp — AREF-1D</title></head><body><main><nav class="sidebar"><span class="name">Entry Points</span><br/><ol><li><a href="../chap-0.xhtml#section-Figures">Table of Contents</a></li><li><a href="../symbol-index.xhtml#section-SymbolIndex">Symbol Index</a></li><li><a href="../figure-index.xhtml#section-FigureIndex">Figure Index</a></li><li><a href="../issue-index.xhtml#section-IssueIndices">Issue Index</a></li><li><a href="../note-indices.xhtml#section-ReviewerNoteIndex">Note Indices</a></li><li><a href="../chapter-26.xhtml#section-Glossary">Glossary</a></li></ol><hr/><span class="name">AREF-1D</span><br/><ol class="local-toc"><li><a href="#section-Status">Status</a><ol> </ol></li><li><a href="#section-References">References</a><ol> </ol></li><li><a href="#section-Edit history">Edit history</a><ol> </ol></li><li><a href="#section-Problem Description">Problem Description</a><ol> </ol></li><li><a href="#issue-aref-1d:row-major-aref">Proposal ROW-MAJOR-AREF</a><ol> </ol></li><li><a href="#section-Rationale">Rationale</a><ol> </ol></li><li><a href="#section-Current Practice">Current Practice</a><ol> </ol></li><li><a href="#section-Adoption Cost">Adoption Cost</a><ol> </ol></li><li><a href="#section-Benefits">Benefits</a><ol> </ol></li><li><a href="#section-Conversion Cost">Conversion Cost</a><ol> </ol></li><li><a href="#section-Aesthetics">Aesthetics</a><ol> </ol></li><li><a href="#section-Discussion">Discussion</a><ol> </ol></li></ol></nav><div class="content"><h1>X3J13 Issue AREF-1D [NIL] [ENHANCEMENT]</h1><section id="section-Status" class="status-passed section"><h2 class="section-title">Status</h2>passed 1988 (not sure which meeting) </section><section id="section-References" class="section"><h2 class="section-title">References</h2>Arrays (pp286-298) </section><section id="section-Edit history" class="section"><h2 class="section-title">Edit history</h2>22-Apr-87, Version 1 by Pitman 02-Jun-87, Version 2 by Pitman (<a class="function-reference" href="../chapter-15.xhtml#function-row-major-aref">row-major-aref</a>) 6-Jun-87, Versions 3, 4 by Masinter (editorial) 11-Jun-87, Version 5, to X3J13 (no changes) 6-Jul-87, Version 6, by Masinter 14-Nov-87, Version 7, by Masinter (update discussion) </section><section id="section-Problem Description" class="section"><h2 class="section-title">Problem Description</h2>It's hard to write functions like Maclisp's LISTARRAY and FILLARRAY efficiently in Common Lisp because they take arguments of varying rank. Currently, you have to make a displaced array to work with temporarily and then throw away the displaced array when you're done. In many cases, this is bothersome because there is no a priori reason why they should have to cons at all. <br/></section><section class="status-passed proposal" id="issue-aref-1d:row-major-aref"><h2 class="section-title">Proposal ROW-MAJOR-AREF</h2>Introduce a new function <a class="function-reference" href="../chapter-15.xhtml#function-row-major-aref">row-major-aref</a> that allows one-dimensional access to the storage backing up a given array assuming the normal row-major storage layout. <br/><a class="function-reference" href="../chapter-15.xhtml#function-row-major-aref">row-major-aref</a> is valid for use with <a class="macro-reference" href="../chapter-5.xhtml#macro-setf">setf</a>. <br/><a class="function-reference" href="../chapter-15.xhtml#function-row-major-aref">row-major-aref</a> array index              [Function] <br/>This accesses and returns the element of array specified by index when the elements of array are considered in row-major order. Array may be an array of any dimensionality. <a class="function-reference" href="../chapter-15.xhtml#function-row-major-aref">row-major-aref</a> may be used with setf. For reference, the following sets of expressions are equivalent: <br/><code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-15.xhtml#function-row-major-aref">row-major-aref</a> <a class="symbol-reference" href="../chapter-2.xhtml#symbol-array">array</a> <span class="syntax-interned-symbol">index</span>)</span>
</span></code> ==     <pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-15.xhtml#function-aref">aref</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-15.xhtml#function-make-array">make-array</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-15.xhtml#function-array-total-size">array-total-size</a> <a class="symbol-reference" href="../chapter-2.xhtml#symbol-array">array</a>)</span>
                      <span class="syntax-keyword-symbol">:displaced-to</span> <a class="symbol-reference" href="../chapter-2.xhtml#symbol-array">array</a>
                      <span class="syntax-keyword-symbol">:element-type</span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-15.xhtml#function-array-element-type">array-element-type</a> <a class="symbol-reference" href="../chapter-2.xhtml#symbol-array">array</a>)</span>)</span>
          <span class="syntax-interned-symbol">index</span>)</span>
</span></code></pre> <br/>and <br/><code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-15.xhtml#function-aref">aref</a> <a class="symbol-reference" href="../chapter-2.xhtml#symbol-array">array</a> <span class="syntax-interned-symbol">..</span> <span class="syntax-interned-symbol">subscripts</span> <span class="syntax-interned-symbol">..</span>)</span>
</span></code> ==     <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-15.xhtml#function-row-major-aref">row-major-aref</a> <a class="symbol-reference" href="../chapter-2.xhtml#symbol-array">array</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-15.xhtml#function-array-row-major-index">array-row-major-index</a> <a class="symbol-reference" href="../chapter-2.xhtml#symbol-array">array</a> <span class="syntax-interned-symbol">..</span> <span class="syntax-interned-symbol">subscripts</span> <span class="syntax-interned-symbol">..</span>)</span>)</span>
</span></code> <br/></section><section id="section-Rationale" class="section"><h2 class="section-title">Rationale</h2>Common Lisp requires row-major storage layout of arrays and has a number of operators that allow users to exploit that order. <a class="function-reference" href="../chapter-15.xhtml#function-row-major-aref">row-major-aref</a> is a useful, simple addition. <br/>LISTARRAY and FILLARRAY, for example, could be trivially defined by loops that had the following form: <br/>    <pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-6.xhtml#macro-dotimes">dotimes</a> <span class="syntax-cons">(<span class="syntax-interned-symbol">I</span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-15.xhtml#function-array-total-size">array-total-size</a> <a class="symbol-reference" href="../chapter-2.xhtml#symbol-array">array</a>)</span>)</span>
      <span class="syntax-interned-symbol">...</span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-15.xhtml#function-row-major-aref">row-major-aref</a> <a class="symbol-reference" href="../chapter-2.xhtml#symbol-array">array</a> <span class="syntax-interned-symbol">I</span>)</span> <span class="syntax-interned-symbol">...</span>)</span>
</span></code></pre> <br/>Currently, the only really efficient way to write this would involve something like: <br/>    <pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-ecase">ecase</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-15.xhtml#function-array-rank">array-rank</a> <span class="syntax-interned-symbol">ARRAY1</span>)</span>
      <span class="syntax-cons">(<span class="syntax-cons">(<span class="syntax-number">0</span>)</span> <span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-setf">setf</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-15.xhtml#function-aref">aref</a> <span class="syntax-interned-symbol">ARRAY1</span>)</span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-15.xhtml#function-aref">aref</a> <span class="syntax-interned-symbol">ARRAY2</span>)</span>)</span>)</span>
      <span class="syntax-cons">(<span class="syntax-cons">(<span class="syntax-number">1</span>)</span> <span class="syntax-cons">(<a class="macro-reference" href="../chapter-6.xhtml#macro-dotimes">dotimes</a> <span class="syntax-cons">(<span class="syntax-interned-symbol">I</span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-15.xhtml#function-array-dimension">array-dimension</a> <a class="symbol-reference" href="../chapter-2.xhtml#symbol-array">array</a> <span class="syntax-number">0</span>)</span>)</span>
	     <span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-setf">setf</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-15.xhtml#function-aref">aref</a> <span class="syntax-interned-symbol">ARRAY1</span> <span class="syntax-interned-symbol">I</span>)</span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-15.xhtml#function-aref">aref</a> <span class="syntax-interned-symbol">ARRAY2</span> <span class="syntax-interned-symbol">I</span>)</span>)</span>)</span>)</span>
      <span class="syntax-cons">(<span class="syntax-cons">(<span class="syntax-number">2</span>)</span> <span class="syntax-cons">(<a class="macro-reference" href="../chapter-6.xhtml#macro-dotimes">dotimes</a> <span class="syntax-cons">(<span class="syntax-interned-symbol">I</span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-15.xhtml#function-array-dimension">array-dimension</a> <a class="symbol-reference" href="../chapter-2.xhtml#symbol-array">array</a> <span class="syntax-number">0</span>)</span>)</span>
	     <span class="syntax-cons">(<a class="macro-reference" href="../chapter-6.xhtml#macro-dotimes">dotimes</a> <span class="syntax-cons">(<span class="syntax-interned-symbol">I</span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-15.xhtml#function-array-dimension">array-dimension</a> <a class="symbol-reference" href="../chapter-2.xhtml#symbol-array">array</a> <span class="syntax-number">1</span>)</span>)</span>
	       <span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-setf">setf</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-15.xhtml#function-aref">aref</a> <span class="syntax-interned-symbol">ARRAY1</span> <span class="syntax-interned-symbol">I</span> <span class="syntax-interned-symbol">J</span>)</span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-15.xhtml#function-aref">aref</a> <span class="syntax-interned-symbol">ARRAY2</span> <span class="syntax-interned-symbol">I</span> <span class="syntax-interned-symbol">J</span>)</span>)</span>)</span>)</span>)</span>
      <span class="syntax-interned-symbol">...some</span> <span class="syntax-interned-symbol">finite</span> <a class="type-reference" href="../chapter-12.xhtml#type-number">number</a> <span class="syntax-interned-symbol">of</span> <span class="syntax-interned-symbol">clauses...</span>)</span>
</span></code></pre> <br/></section><section id="section-Current Practice" class="section"><h2 class="section-title">Current Practice</h2>Many implementations have this primitive under some other name for use internally. In Symbolics systems, for example, it is SYS:%1D-AREF. <br/></section><section id="section-Adoption Cost" class="section"><h2 class="section-title">Adoption Cost</h2>This change is fairly localized. In implementations that already use this primitive internally, it's little more than a matter of changing the name of or otherwise releasing the existing primitive. In some implementations, it might involve writing a small amount of code or compiler work to make <a class="function-reference" href="../chapter-15.xhtml#function-row-major-aref">row-major-aref</a> work efficiently. <br/></section><section id="section-Benefits" class="section"><h2 class="section-title">Benefits</h2>This gives users efficient access to something to which they already have inefficient access. <br/></section><section id="section-Conversion Cost" class="section"><h2 class="section-title">Conversion Cost</h2>This is an upward-compatible change; the name <a class="function-reference" href="../chapter-15.xhtml#function-row-major-aref">row-major-aref</a> is unlikely to be used by any current program. <br/></section><section id="section-Aesthetics" class="section"><h2 class="section-title">Aesthetics</h2>This allows certain programs to be written in a more aesthetic way. <br/></section><section id="section-Discussion" class="section"><h2 class="section-title">Discussion</h2>This issue was conditionally passed at X3J13/June 1987, pending clarification of some details. Those clarifications have been made in this version. </section></div></main><footer>Copyright © 2021 Jan Moringen</footer></body></html>