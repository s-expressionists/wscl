<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN"
  "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="utf-8"/><link rel="stylesheet" type="text/css" href="../style.css"/><script src="../permalink.js"/><script src="../navigation.js"/><title>Well-specified Common Lisp — &amp;ENVIRONMENT-BINDING-ORDER</title></head><body><main><nav class="sidebar"><span class="name">Entry Points</span><br/><ol><li><a href="../chap-0.xhtml#section-Figures">Table of Contents</a></li><li><a href="../symbol-index.xhtml#section-SymbolIndex">Symbol Index</a></li><li><a href="../figure-index.xhtml#section-FigureIndex">Figure Index</a></li><li><a href="../issue-index.xhtml#section-IssueIndices">Issue Index</a></li><li><a href="../note-indices.xhtml#section-ReviewerNoteIndex">Note Indices</a></li><li><a href="../chapter-26.xhtml#section-Glossary">Glossary</a></li></ol><hr/><span class="name">&amp;ENVIRONMENT-BINDING-ORDER</span><br/><ol class="local-toc"><li><a href="#section-Status">Status</a><ol> </ol></li><li><a href="#section-References">References</a><ol> </ol></li><li><a href="#section-Edit History">Edit History</a><ol> </ol></li><li><a href="#section-Problem Description">Problem Description</a><ol> </ol></li><li><a href="#issue-&amp;environment-binding-order:first">Proposal FIRST</a><ol> <li><a href="#section-Rationale">Rationale</a><ol> </ol></li></ol></li><li><a href="#issue-&amp;environment-binding-order:left-to-right">Proposal LEFT-TO-RIGHT</a><ol> <li><a href="#section-Rationale">Rationale</a><ol> </ol></li></ol></li><li><a href="#section-Current Practice">Current Practice</a><ol> </ol></li><li><a href="#section-Cost to implementors">Cost to implementors</a><ol> </ol></li><li><a href="#section-Cost to users">Cost to users</a><ol> </ol></li><li><a href="#section-Benefits">Benefits</a><ol> </ol></li><li><a href="#section-Discussion">Discussion</a><ol> </ol></li></ol></nav><div class="content"><h1>X3J13 Issue &amp;ENVIRONMENT-BINDING-ORDER [Cleanup] [CLARIFICATION]</h1><section id="section-Status" class="status-passed section"><h2 class="section-title">Status</h2>Proposal <a class="function-reference" href="../chapter-14.xhtml#function-first">FIRST</a> passed, Nov 89 X3J13 </section><section id="section-References" class="section"><h2 class="section-title">References</h2>CLtL p. 145-146, 63 <a class="issue-reference" href="../issues/defmacro-lambda-list.xhtml#issue-defmacro-lambda-list">X3J13 Issue DEFMACRO-LAMBDA-LIST</a> </section><section id="section-Edit History" class="section"><h2 class="section-title">Edit History</h2>V1, 24 Oct 1989, Sandra Loosemore V3, 02 Nov 1989, Sandra Loosemore (comments from Moon) <br/></section><section id="section-Problem Description" class="section"><h2 class="section-title">Problem Description</h2><a class="issue-reference" href="../issues/defmacro-lambda-list.xhtml#issue-defmacro-lambda-list">X3J13 Issue DEFMACRO-LAMBDA-LIST</a> states that <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-environment">&amp;ENVIRONMENT</a> can appear once anywhere at top level of a macro lambda list, but doesn't say anything about the order in which the <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-environment">&amp;ENVIRONMENT</a> variable is bound relative to the other lambda-list variables. <br/>Some implementations treat <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-environment">&amp;ENVIRONMENT</a> as a mechanism for naming the second argument to the macro function, in which case it is bound before any of the variables in the actual destructuring pattern. Other implementations bind it with the other lambda parameters in the usual <a class="proposal-reference" href="#issue-&amp;environment-binding-order:left-to-right">left-to-right</a> order. <br/>The binding order of <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-whole">&amp;WHOLE</a> parameters is not an issue.  This is because a <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-whole">&amp;WHOLE</a> parameter must appear first in the lambda list, so there is no difference between binding it first or binding it <a class="proposal-reference" href="#issue-&amp;environment-binding-order:left-to-right">left-to-right</a>.  The relative binding order of <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-whole">&amp;WHOLE</a> and <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-environment">&amp;ENVIRONMENT</a> parameters is not an issue because neither one can include init forms where the binding of the other might be visible. <br/>There are two proposals, <a class="function-reference" href="../chapter-14.xhtml#function-first">FIRST</a> and <a class="proposal-reference" href="#issue-&amp;environment-binding-order:left-to-right">LEFT-TO-RIGHT</a>. <br/></section><section class="status-passed proposal" id="issue-&amp;environment-binding-order:first"><h2 class="section-title">Proposal FIRST</h2>Clarify that the <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-environment">&amp;ENVIRONMENT</a> parameter is bound along with <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-whole">&amp;WHOLE</a> before any of other variables in the lambda list, regardless of where <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-environment">&amp;ENVIRONMENT</a> appears in the lambda list. <br/><section id="section-Rationale" class="section"><h2 class="section-title">Rationale</h2>This proposal provides a convenient explanation for the special treatment of <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-whole">&amp;WHOLE</a> and <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-environment">&amp;ENVIRONMENT</a> at top-level in a DEFMACRO-style lambda list.  Basically, these two parameters are stripped out and used to name the two arguments to the macro function, then the binding of the remaining arguments is handled exactly the same as at non-top-level or in a <a class="macro-reference" href="../chapter-5.xhtml#macro-destructuring-bind">DESTRUCTURING-BIND</a>.  It is also very straightforward to implement this model <pre><code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">as</span> <span class="syntax-interned-symbol">opposed</span> <span class="syntax-interned-symbol">to</span> <span class="syntax-interned-symbol">having</span>
  <a class="symbol-reference" href="../chapter-3.xhtml#symbol-special">special</a> <span class="syntax-interned-symbol">parsing</span> <span class="syntax-interned-symbol">code</span> <span class="syntax-interned-symbol">for</span> <span class="syntax-interned-symbol">destructuring</span> <span class="syntax-interned-symbol">top-level</span> <a class="macro-reference" href="../chapter-3.xhtml#macro-defmacro">DEFMACRO</a> <a class="macro-reference" href="../chapter-3.xhtml#macro-lambda">lambda</a>
  <span class="syntax-interned-symbol">lists</span>)</span>
</span></code></pre>. <br/></section></section><section class="status-unknown proposal" id="issue-&amp;environment-binding-order:left-to-right"><h2 class="section-title">Proposal LEFT-TO-RIGHT</h2>Clarify that the all lambda variables in a DEFMACRO-style lambda list are bound <a class="proposal-reference" href="#issue-&amp;environment-binding-order:left-to-right">left-to-right</a>, including the <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-whole">&amp;WHOLE</a> and <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-environment">&amp;ENVIRONMENT</a> parameters. <br/><section id="section-Rationale" class="section"><h2 class="section-title">Rationale</h2>This is more consistent with the order in which variables in ordinary  lambda lists are bound. <br/></section></section><section id="section-Current Practice" class="section"><h2 class="section-title">Current Practice</h2>Lucid <a class="package-reference" href="../chapter-11.xhtml#package-cl">CL</a>, Utah <a class="package-reference" href="../chapter-11.xhtml#package-cl">CL</a>, and KCL implement proposal <a class="function-reference" href="../chapter-14.xhtml#function-first">FIRST</a>.  CMU <a class="package-reference" href="../chapter-11.xhtml#package-cl">CL</a> implements proposal <a class="proposal-reference" href="#issue-&amp;environment-binding-order:left-to-right">LEFT-TO-RIGHT</a>. <br/>Symbolics Genera implements proposal <a class="function-reference" href="../chapter-14.xhtml#function-first">FIRST</a>.  Specifically, <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-whole">&amp;WHOLE</a> is bound first, followed by <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-environment">&amp;ENVIRONMENT</a>, then the destructuring variables in the order listed. <br/></section><section id="section-Cost to implementors" class="section"><h2 class="section-title">Cost to implementors</h2>The changes are probably localized but potentially hairy.  It is possible that in some implementations it might be easier to completely replace the code which handles lambda-list parsing and destructuring than to try to patch it.  Proposal <a class="function-reference" href="../chapter-14.xhtml#function-first">FIRST</a> is probably easier to implement initially but the cost of converting an existing implementation is probably about the same for both proposals. <br/></section><section id="section-Cost to users" class="section"><h2 class="section-title">Cost to users</h2>There are probably few user programs that would be affected by a change in the binding order of <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-environment">&amp;ENVIRONMENT</a> parameters. <br/></section><section id="section-Benefits" class="section"><h2 class="section-title">Benefits</h2>The language specification is made more precise. <br/></section><section id="section-Discussion" class="section"><h2 class="section-title">Discussion</h2>Moon says:   I believe <a class="proposal-reference" href="#issue-&amp;environment-binding-order:left-to-right">LEFT-TO-RIGHT</a> is more clean, but I don't have strong feelings.   I am equally in favor of either of the two presented proposals or an   EXPLICITLY-VAGUE proposal. <br/></section></div></main><footer>Copyright © 2021 Jan Moringen</footer></body></html>