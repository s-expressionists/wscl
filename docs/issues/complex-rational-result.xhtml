<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN"
  "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="utf-8"/><link rel="stylesheet" type="text/css" href="../style.css"/><script src="../permalink.js"/><script src="../navigation.js"/><title>Well-specified Common Lisp — COMPLEX-RATIONAL-RESULT</title></head><body><main><nav class="sidebar"><span class="name">Entry Points</span><br/><ol><li><a href="../chap-0.xhtml#section-Figures">Table of Contents</a></li><li><a href="../symbol-index.xhtml#section-SymbolIndex">Symbol Index</a></li><li><a href="../figure-index.xhtml#section-FigureIndex">Figure Index</a></li><li><a href="../issue-index.xhtml#section-IssueIndices">Issue Index</a></li><li><a href="../note-indices.xhtml#section-ReviewerNoteIndex">Note Indices</a></li><li><a href="../chapter-26.xhtml#section-Glossary">Glossary</a></li></ol><hr/><span class="name">COMPLEX-RATIONAL-RESULT</span><br/><ol class="local-toc"><li><a href="#section-Status">Status</a><ol> </ol></li><li><a href="#section-References">References</a><ol> </ol></li><li><a href="#section-Edit history">Edit history</a><ol> </ol></li><li><a href="#section-Problem description">Problem description</a><ol> </ol></li><li><a href="#issue-complex-rational-result:extend">Proposal EXTEND</a><ol> </ol></li><li><a href="#section-Examples">Examples</a><ol> </ol></li><li><a href="#section-Rationale">Rationale</a><ol> </ol></li><li><a href="#section-Current practice">Current practice</a><ol> </ol></li><li><a href="#section-Cost to Implementors">Cost to Implementors</a><ol> </ol></li><li><a href="#section-Cost to Users">Cost to Users</a><ol> </ol></li><li><a href="#section-Cost of non-adoption">Cost of non-adoption</a><ol> </ol></li><li><a href="#section-Performance impact">Performance impact</a><ol> </ol></li><li><a href="#section-Benefits/Esthetics">Benefits/Esthetics</a><ol> </ol></li><li><a href="#section-Discussion">Discussion</a><ol> </ol></li></ol></nav><div class="content"><h1>X3J13 Issue COMPLEX-RATIONAL-RESULT [NIL] [CLARIFICATION]</h1><section id="section-Status" class="status-passed section"><h2 class="section-title">Status</h2>Version 3 passed Jun89 X3J13 (Version 1 passed March 89, but had problems) </section><section id="section-References" class="section"><h2 class="section-title">References</h2>CLtL p.203 </section><section id="section-Edit history" class="section"><h2 class="section-title">Edit history</h2>Version 1, 20-Mar-89, by Moon Version 2, 08-Apr-89, by Steele Version 3, 28-Apr-89, by Steele </section><section id="section-Problem description" class="section"><h2 class="section-title">Problem description</h2>  Referring to irrational and transcendental functions, CLtL says: <br/>    When the arguments to a function in this section are all rational and     the true mathematical result is also <code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">mathematically</span>)</span>
</span></code> rational, then     unless otherwise noted an implementation is free to return either an     accurate result of type rational or a single-precision floating-point     approximation.  If the arguments are all rational but the result cannot     be expressed as a rational number, then a single-precision     floating-point approximation is always returned. <br/>  Referring to <a class="function-reference" href="../chapter-12.xhtml#function-expt">expt</a>, CLtL says: <br/>    If the base-number is of type <a class="function-reference" href="../chapter-12.xhtml#function-rational">rational</a> and the power-number is an     <a class="type-reference" href="../chapter-12.xhtml#type-integer">integer</a>, the calculation will be exact and the result will be of     type <a class="function-reference" href="../chapter-12.xhtml#function-rational">rational</a>; otherwise a floating-point approximation may result. <br/>  What about arguments of type <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-complex">complex</a> <a class="function-reference" href="../chapter-12.xhtml#function-rational">rational</a>)</span>
</span></code>? <br/></section><section class="status-passed proposal" id="issue-complex-rational-result:extend"><h2 class="section-title">Proposal EXTEND</h2>  Extend the paragraph quoted above as follows to cover the components   of complex numbers.  If the arguments to a function are all of type   <code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-or">or</a> <a class="function-reference" href="../chapter-12.xhtml#function-rational">rational</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-complex">complex</a> <a class="function-reference" href="../chapter-12.xhtml#function-rational">rational</a>)</span>)</span>
</span></code> and the true mathematical result is   <code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">mathematically</span>)</span>
</span></code> a complex number with rational real and imaginary   parts, then unless otherwise noted an implementation is free to return   either an accurate result of type <code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-or">or</a> <a class="function-reference" href="../chapter-12.xhtml#function-rational">rational</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-complex">complex</a> <a class="function-reference" href="../chapter-12.xhtml#function-rational">rational</a>)</span>)</span>
</span></code> or   a single-precision floating-point approximation of type <a class="type-reference" href="../chapter-12.xhtml#type-single-float">single-float</a>   <pre><code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">permissible</span> <span class="syntax-interned-symbol">only</span> <a class="special-operator-reference" href="../chapter-5.xhtml#special-operator-if">if</a> <a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">the</a> <span class="syntax-interned-symbol">imaginary</span> <span class="syntax-interned-symbol">part</span> <span class="syntax-interned-symbol">of</span> <a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">the</a> <span class="syntax-interned-symbol">true</span> <span class="syntax-interned-symbol">mathematical</span>
  <span class="syntax-interned-symbol">result</span> <span class="syntax-interned-symbol">is</span> <span class="syntax-interned-symbol">zero</span>)</span>
</span></code></pre> or <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-complex">complex</a> <a class="type-reference" href="../chapter-12.xhtml#type-single-float">single-float</a>)</span>
</span></code>. If the arguments are   all of type <code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-or">or</a> <a class="function-reference" href="../chapter-12.xhtml#function-rational">rational</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-complex">complex</a> <a class="function-reference" href="../chapter-12.xhtml#function-rational">rational</a>)</span>)</span>
</span></code> but the result cannot be   expressed as a rational or complex rational number, then the returned   value will be of type <a class="type-reference" href="../chapter-12.xhtml#type-single-float">single-float</a> <pre><code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">permissible</span> <span class="syntax-interned-symbol">only</span> <a class="special-operator-reference" href="../chapter-5.xhtml#special-operator-if">if</a> <a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">the</a> <span class="syntax-interned-symbol">imaginary</span>
  <span class="syntax-interned-symbol">part</span> <span class="syntax-interned-symbol">of</span> <a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">the</a> <span class="syntax-interned-symbol">true</span> <span class="syntax-interned-symbol">mathematical</span> <span class="syntax-interned-symbol">result</span> <span class="syntax-interned-symbol">is</span> <span class="syntax-interned-symbol">zero</span>)</span>
</span></code></pre> or <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-complex">complex</a> <a class="type-reference" href="../chapter-12.xhtml#type-single-float">single-float</a>)</span>
</span></code>. <br/>  For <a class="function-reference" href="../chapter-12.xhtml#function-expt">expt</a> of a <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-complex">complex</a> <a class="function-reference" href="../chapter-12.xhtml#function-rational">rational</a>)</span>
</span></code> to an integer power, the   calculation must be exact and the result will be of type   <code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-or">or</a> <a class="function-reference" href="../chapter-12.xhtml#function-rational">rational</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-complex">complex</a> <a class="function-reference" href="../chapter-12.xhtml#function-rational">rational</a>)</span>)</span>
</span></code>. <br/></section><section id="section-Examples" class="section"><h2 class="section-title">Examples</h2><pre>[a]  <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-log">log</a> <span class="syntax-number">#c<span class="syntax-symbol">(<span class="syntax-number">-16</span> <span class="syntax-number">16</span>)</span></span> <span class="syntax-number">#c<span class="syntax-symbol">(<span class="syntax-number">2</span> <span class="syntax-number">2</span>)</span></span>)</span>
</span></code> <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a>&gt; 3 or approximately #c<code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-number">3.0</span> <span class="syntax-number">0.0</span>)</span>
</span></code><br/>			           or approximately 3.0 <code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">unlikely</span>)</span>
</span></code><br/>[b]  <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-abs">abs</a> <span class="syntax-number">#c<span class="syntax-symbol">(<span class="syntax-number">3/5</span> <span class="syntax-number">4/5</span>)</span></span>)</span>
</span></code> <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a>&gt; 1 or approximately 1.0<br/>[c]  <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-expt">expt</a> <span class="syntax-number">#c<span class="syntax-symbol">(<span class="syntax-number">2</span> <span class="syntax-number">2</span>)</span></span> <span class="syntax-number">3</span>)</span>
</span></code> <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a>&gt; #c<code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-number">-16</span> <span class="syntax-number">16</span>)</span>
</span></code><br/>[d]  <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-expt">expt</a> <span class="syntax-number">#c<span class="syntax-symbol">(<span class="syntax-number">2</span> <span class="syntax-number">2</span>)</span></span> <span class="syntax-number">4</span>)</span>
</span></code> <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a>&gt; -64 <br/><br/></pre></section><section id="section-Rationale" class="section"><h2 class="section-title">Rationale</h2>  This seems most consistent with the treatment of real numbers. <br/></section><section id="section-Current practice" class="section"><h2 class="section-title">Current practice</h2>			[a]			[b]	[c]		[d] Symbolics Genera 7.4	#c<code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">3.00...</span> <span class="syntax-interned-symbol">1.40...e-7</span>)</span>
</span></code>	1	#c<code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-number">-16</span> <span class="syntax-number">16</span>)</span>
</span></code>	-64 Sun Common Lisp 3.0.1	#c<code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-number">3.0</span> <span class="syntax-interned-symbol">2.61...e-16</span>)</span>
</span></code>	1.0	#c<code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-number">-16</span> <span class="syntax-number">16</span>)</span>
</span></code>	-64 KCL of 9/16/86 on VAX	#c<code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-number">3.0s0</span> <span class="syntax-interned-symbol">-1.40...s-7</span>)</span>
</span></code>	1.0s0	#c<code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-number">-16</span> <span class="syntax-number">16</span>)</span>
</span></code>	-64 Allegro <a class="package-reference" href="../chapter-11.xhtml#package-cl">cl</a> (Mac II)	#c<code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-number">3.0</span> <span class="syntax-interned-symbol">2.05...e-16</span>)</span>
</span></code>	1.0	#c<code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-number">-16</span> <span class="syntax-number">16</span>)</span>
</span></code>	-64 <br/></section><section id="section-Cost to Implementors" class="section"><h2 class="section-title">Cost to Implementors</h2>  Only <a class="function-reference" href="../chapter-12.xhtml#function-expt">expt</a> would have to change, since the type of the other results   is at the discretion of the implementation. <br/></section><section id="section-Cost to Users" class="section"><h2 class="section-title">Cost to Users</h2>  Probably none, but it is hard to predict. <br/></section><section id="section-Cost of non-adoption" class="section"><h2 class="section-title">Cost of non-adoption</h2>  Slightly less self-consistent language. <br/></section><section id="section-Performance impact" class="section"><h2 class="section-title">Performance impact</h2>  None of any significance. <br/></section><section id="section-Benefits/Esthetics" class="section"><h2 class="section-title">Benefits/Esthetics</h2>  More self-consistent language. <br/></section><section id="section-Discussion" class="section"><h2 class="section-title">Discussion</h2>  None. </section></div></main><footer>Copyright © 2021 Jan Moringen</footer></body></html>