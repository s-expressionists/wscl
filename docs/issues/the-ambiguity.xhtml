<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN"
  "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="utf-8"/><link rel="stylesheet" type="text/css" href="../style.css"/><script src="../permalink.js"/><script src="../navigation.js"/><title>Well-specified Common Lisp — THE-AMBIGUITY</title></head><body><main><nav class="sidebar"><span class="name">Entry Points</span><br/><ol><li><a href="../chap-0.xhtml#section-Figures">Table of Contents</a></li><li><a href="../symbol-index.xhtml#section-SymbolIndex">Symbol Index</a></li><li><a href="../figure-index.xhtml#section-FigureIndex">Figure Index</a></li><li><a href="../issue-index.xhtml#section-IssueIndices">Issue Index</a></li><li><a href="../note-indices.xhtml#section-ReviewerNoteIndex">Note Indices</a></li><li><a href="../chapter-26.xhtml#section-Glossary">Glossary</a></li></ol><hr/><span class="name">THE-AMBIGUITY</span><br/><ol class="local-toc"><li><a href="#section-Status">Status</a><ol> </ol></li><li><a href="#section-References">References</a><ol> </ol></li><li><a href="#section-Edit history">Edit history</a><ol> </ol></li><li><a href="#section-Problem description">Problem description</a><ol> </ol></li><li><a href="#issue-the-ambiguity:for-declaration">Proposal FOR-DECLARATION</a><ol> </ol></li><li><a href="#issue-the-ambiguity:for-discrimination">Proposal FOR-DISCRIMINATION</a><ol> </ol></li><li><a href="#section-Current practice">Current practice</a><ol> </ol></li><li><a href="#section-Test case">Test case</a><ol> </ol></li><li><a href="#section-Cost to implementors">Cost to implementors</a><ol> </ol></li><li><a href="#section-Cost to users">Cost to users</a><ol> </ol></li><li><a href="#section-Benefits">Benefits</a><ol> </ol></li><li><a href="#section-Aesthetics">Aesthetics</a><ol> </ol></li><li><a href="#section-Discussion">Discussion</a><ol> </ol></li></ol></nav><div class="content"><h1>X3J13 Issue THE-AMBIGUITY [cleanup] [CLARIFICATION]</h1><section id="section-Status" class="status-passed section"><h2 class="section-title">Status</h2>proposal <a class="proposal-reference" href="#issue-the-ambiguity:for-declaration">FOR-DECLARATION</a> passed, Jun 89 X3J13 </section><section id="section-References" class="section"><h2 class="section-title">References</h2><a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">THE</a> (page 161) </section><section id="section-Edit history" class="section"><h2 class="section-title">Edit history</h2>21-Oct-88, version 1 by Rees 11-Jan-89, version 2 by Masinter (fix typos) </section><section id="section-Problem description" class="section"><h2 class="section-title">Problem description</h2>  CLtL does not explicitly say whether the type specifier in a <a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">THE</a>   form may be any type specifier or must be a type specifier suitable   for discrimination.  Although <a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">THE</a> is decsribed as a "declaration"   form, some <a class="package-reference" href="../chapter-11.xhtml#package-cl">CL</a> implementations have assumed that the specifier must   be for discrimination, and disallow e.g., <br/>    <code><span class="syntax-root"><span class="syntax-cons">(<a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">THE</a> <span class="syntax-cons">(<a class="special-operator-reference" href="../chapter-5.xhtml#special-operator-function">FUNCTION</a> <span class="syntax-cons">(<a class="section-reference" href="../chapter-26.xhtml#section-T">T</a> <a class="section-reference" href="../chapter-26.xhtml#section-T">T</a>)</span> <a class="function-reference" href="../chapter-14.xhtml#function-cons">CONS</a>)</span> <span class="syntax-function">#'<a class="function-reference" href="../chapter-14.xhtml#function-cons">CONS</a></span>)</span>
</span></code> <br/>  We should either say that the implementations are right, or   explicitly say that they are wrong, since this case is easily   overlooked. <br/></section><section class="status-passed proposal" id="issue-the-ambiguity:for-declaration"><h2 class="section-title">Proposal FOR-DECLARATION</h2>  Clarify that the type specifier in <br/>	<code><span class="syntax-root"><span class="syntax-cons">(<a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">THE</a> <a class="symbol-reference" href="../chapter-25.xhtml#symbol-type">type</a> <a class="function-reference" href="../chapter-12.xhtml#function-exp">exp</a>)</span>
</span></code> <br/>  may be any valid type specifier.  In the case that exp returns one   value and type is not a <a class="function-reference" href="../chapter-5.xhtml#function-values">VALUES</a> type specifier, <code><span class="syntax-root"><span class="syntax-cons">(<a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">THE</a> <a class="symbol-reference" href="../chapter-25.xhtml#symbol-type">type</a> <a class="function-reference" href="../chapter-12.xhtml#function-exp">exp</a>)</span>
</span></code> is   equivalent to <br/>	<pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="special-operator-reference" href="../chapter-5.xhtml#special-operator-let">LET</a> <span class="syntax-cons">(<span class="syntax-cons">(<span class="syntax-interned-symbol">g</span> <a class="function-reference" href="../chapter-12.xhtml#function-exp">exp</a>)</span>)</span>
	  <span class="syntax-cons">(<a class="symbol-reference" href="../chapter-3.xhtml#symbol-declare">DECLARE</a> <span class="syntax-cons">(<a class="symbol-reference" href="../chapter-25.xhtml#symbol-type">TYPE</a> <a class="symbol-reference" href="../chapter-25.xhtml#symbol-type">type</a> <span class="syntax-interned-symbol">g</span>)</span>)</span>
	  <span class="syntax-interned-symbol">g</span>)</span>
</span></code></pre> <br/>  where "g" is a gensym. <br/></section><section class="status-unknown proposal" id="issue-the-ambiguity:for-discrimination"><h2 class="section-title">Proposal FOR-DISCRIMINATION</h2>  Clarify that the type specifier in <br/>	<code><span class="syntax-root"><span class="syntax-cons">(<a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">THE</a> <a class="symbol-reference" href="../chapter-25.xhtml#symbol-type">type</a> <a class="function-reference" href="../chapter-12.xhtml#function-exp">exp</a>)</span>
</span></code> <br/>  must be a valid type for discrimination, as for <a class="function-reference" href="../chapter-4.xhtml#function-typep">TYPEP</a>, or it must   be of the form <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-5.xhtml#function-values">VALUES</a> <span class="syntax-interned-symbol">type*</span>)</span>
</span></code> where type* are all valid for discrimination. <br/></section><section id="section-Current practice" class="section"><h2 class="section-title">Current practice</h2>  The Symbolics Genera and VAX <a class="package-reference" href="../chapter-A.xhtml#package-lisp">LISP</a> V2.2 interpreters signal errors for <br/>	<code><span class="syntax-root"><span class="syntax-cons">(<a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">THE</a> <span class="syntax-cons">(<a class="special-operator-reference" href="../chapter-5.xhtml#special-operator-function">FUNCTION</a> <span class="syntax-cons">(<a class="section-reference" href="../chapter-26.xhtml#section-T">T</a> <a class="section-reference" href="../chapter-26.xhtml#section-T">T</a>)</span> <a class="function-reference" href="../chapter-14.xhtml#function-cons">CONS</a>)</span> <span class="syntax-function">#'<a class="function-reference" href="../chapter-14.xhtml#function-cons">CONS</a></span>)</span>
</span></code>, <br/>  but this may not be intentional.  CLtL would seem to allow it. <br/></section><section id="section-Test case" class="section"><h2 class="section-title">Test case</h2>  <code><span class="syntax-root"><span class="syntax-cons">(<a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">THE</a> <span class="syntax-cons">(<a class="special-operator-reference" href="../chapter-5.xhtml#special-operator-function">FUNCTION</a> <span class="syntax-cons">(<a class="section-reference" href="../chapter-26.xhtml#section-T">T</a> <a class="section-reference" href="../chapter-26.xhtml#section-T">T</a>)</span> <a class="function-reference" href="../chapter-14.xhtml#function-cons">CONS</a>)</span> <span class="syntax-function">#'<a class="function-reference" href="../chapter-14.xhtml#function-cons">CONS</a></span>)</span>
</span></code>, <br/>  should return the <a class="function-reference" href="../chapter-14.xhtml#function-cons">CONS</a> function under <a class="proposal-reference" href="#issue-the-ambiguity:for-declaration">FOR-DECLARATION</a>,   and should be an error under <a class="proposal-reference" href="#issue-the-ambiguity:for-discrimination">FOR-DISCRIMINATION</a>. <br/></section><section id="section-Cost to implementors" class="section"><h2 class="section-title">Cost to implementors</h2>  Trivial cost for <a class="issue-reference" href="#issue-the-ambiguity:for-discrimination">THE-AMBIGUITY:FOR-DISCRIMINATION</a>; this is a compatible   restriction. <br/>  For <a class="issue-reference" href="#issue-the-ambiguity:for-declaration">THE-AMBIGUITY:FOR-DECLARATION</a>, implementations that do not   already allow arbitrary type specifiers but which want to check that   the type in a <a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">THE</a> is satisfied would have to create an internal   version of <a class="function-reference" href="../chapter-4.xhtml#function-typep">TYPEP</a> which could manage not to signal invalid-type-specifier   errors in those situations where <a class="function-reference" href="../chapter-4.xhtml#function-typep">TYPEP</a> would because the type is a   declaration-only one. <br/></section><section id="section-Cost to users" class="section"><h2 class="section-title">Cost to users</h2>  Users of implementations that support <a class="issue-reference" href="#issue-the-ambiguity:for-declaration">THE-AMBIGUITY:FOR-DECLARATION</a>   might have to remove or change some uses of <a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">THE</a> in their code if the   opposing alternative is adopted. <br/></section><section id="section-Benefits" class="section"><h2 class="section-title">Benefits</h2>  Either way, an ambiguity in the language specification would be clarified. <br/></section><section id="section-Aesthetics" class="section"><h2 class="section-title">Aesthetics</h2>  <a class="issue-reference" href="#issue-the-ambiguity:for-declaration">THE-AMBIGUITY:FOR-DECLARATION</a> would seem to be more consistent with   <a class="symbol-reference" href="../chapter-3.xhtml#symbol-declare">DECLARE</a> and with the intent of <a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">THE</a>, which is supposed to be a way to   provide information for documentation and for the benefit of compilation. <br/></section><section id="section-Discussion" class="section"><h2 class="section-title">Discussion</h2>  Rees supports <a class="issue-reference" href="#issue-the-ambiguity:for-declaration">THE-AMBIGUITY:FOR-DECLARATION</a>. <br/>  Appropriate error situation terminology must be chosen for the   situation that a <a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">THE</a> declaration <code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-or">or</a> <span class="syntax-interned-symbol">other</span> <a class="symbol-reference" href="../chapter-3.xhtml#symbol-declaration">declaration</a>)</span>
</span></code> is   unsatisfied, but that must be done regardless of this proposal. <br/>  This proposal would suggest that a function should be added to <a class="package-reference" href="../chapter-11.xhtml#package-cl">CL</a> to   do the checking that <a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">THE</a> would want to do: <br/>	  <code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">PROBABLY-TYPEP</span> <span class="syntax-interned-symbol">object</span> <span class="syntax-interned-symbol">type-spec</span>)</span>
</span></code> <br/>  [terrible name of course] returns multiple values a la <a class="function-reference" href="../chapter-4.xhtml#function-subtypep">SUBTYPEP</a>: <a class="section-reference" href="../chapter-26.xhtml#section-T">T</a> <a class="section-reference" href="../chapter-26.xhtml#section-T">T</a>   if the object definitely has the type, <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a> <a class="section-reference" href="../chapter-26.xhtml#section-T">T</a> if it definitely   doesn't, and <a class="section-reference" href="../chapter-26.xhtml#section-T">T</a> <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a> <code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-or">or</a> <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a> <span class="syntax-interned-symbol">NIL?</span>)</span>
</span></code> otherwise.  Assuming that an   interpreted THE-expression actually checks types, you could almost   define this function using the condition system and <a class="function-reference" href="../chapter-3.xhtml#function-eval">EVAL</a>.  (Ugh!)   Without PROBABLY-TYPEP, a meta-circular interpreter is more   difficult to write. <br/>  If a suitable name was found for this function, the additional   functionality could be suggested as an independent proposal, since   regardless of the outcome of this issue, the functionality is still   useful for checking <a class="symbol-reference" href="../chapter-3.xhtml#symbol-declare">DECLARE</a>'s. <br/>  Various implementation mechanisms were discussed for dealing   with <a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">THE</a> checking. <br/>  Are there any remaining type specifiers beyond the list form   of the <a class="special-operator-reference" href="../chapter-5.xhtml#special-operator-function">FUNCTION</a> type that differ between "declaration" and   "discrimination"? <br/>  "I support <a class="proposal-reference" href="#issue-the-ambiguity:for-declaration">FOR-DECLARATION</a>.  Lucid <a class="package-reference" href="../chapter-11.xhtml#package-cl">CL</a> has the same bug in   the interpreter as the others <code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">a</span> <span class="syntax-string">"bug"</span> <span class="syntax-interned-symbol">assuming</span> <span class="syntax-interned-symbol">FOR-DECLARATION</span>)</span>
</span></code>.   <a class="function-reference" href="../chapter-4.xhtml#function-typep">TYPEP</a> is used to check the legality of the type specifier in <a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">THE</a>." <br/>  In considering possible ways in which the type-checking logic   for <a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">THE</a> and <a class="symbol-reference" href="../chapter-3.xhtml#symbol-declare">DECLARE</a> might work, don't forget things like 	<code><span class="syntax-root"><span class="syntax-cons">(<a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">the</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-5.xhtml#function-not">not</a> <span class="syntax-cons">(<a class="special-operator-reference" href="../chapter-5.xhtml#special-operator-function">function</a> <span class="syntax-cons">(<a class="section-reference" href="../chapter-26.xhtml#section-T">t</a> <a class="section-reference" href="../chapter-26.xhtml#section-T">t</a>)</span> <a class="type-reference" href="../chapter-12.xhtml#type-integer">integer</a>)</span>)</span> <span class="syntax-number">7</span>)</span>
</span></code>,   which you would want to signal an error.  I don't think this can be   done with only <a class="function-reference" href="../chapter-4.xhtml#function-typep">TYPEP</a> and conditions. </section></div></main><footer>Copyright © 2021 Jan Moringen</footer></body></html>