<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN"
  "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="utf-8"/><link rel="stylesheet" type="text/css" href="../style.css"/><script src="../permalink.js"/><script src="../navigation.js"/><title>Well-specified Common Lisp — DEFTYPE-KEY</title></head><body><main><nav class="sidebar"><span class="name">Entry Points</span><br/><ol><li><a href="../chap-0.xhtml#section-Figures">Table of Contents</a></li><li><a href="../symbol-index.xhtml#section-SymbolIndex">Symbol Index</a></li><li><a href="../figure-index.xhtml#section-FigureIndex">Figure Index</a></li><li><a href="../issue-index.xhtml#section-IssueIndices">Issue Index</a></li><li><a href="../note-indices.xhtml#section-ReviewerNoteIndex">Note Indices</a></li><li><a href="../chapter-26.xhtml#section-Glossary">Glossary</a></li></ol><hr/><span class="name">DEFTYPE-KEY</span><br/><ol class="local-toc"><li><a href="#section-References">References</a><ol> </ol></li><li><a href="#section-Edit history">Edit history</a><ol> </ol></li><li><a href="#section-Problem description">Problem description</a><ol> </ol></li><li><a href="#issue-deftype-key:allow">Proposal ALLOW</a><ol> </ol></li><li><a href="#section-Examples">Examples</a><ol> </ol></li><li><a href="#section-Rationale">Rationale</a><ol> </ol></li><li><a href="#section-Current practice">Current practice</a><ol> </ol></li><li><a href="#section-Cost to Implementors">Cost to Implementors</a><ol> </ol></li><li><a href="#section-Cost to Users">Cost to Users</a><ol> </ol></li><li><a href="#section-Cost of non-adoption">Cost of non-adoption</a><ol> </ol></li><li><a href="#section-Performance impact">Performance impact</a><ol> </ol></li><li><a href="#section-Benefits">Benefits</a><ol> </ol></li><li><a href="#section-Esthetics">Esthetics</a><ol> </ol></li><li><a href="#section-Discussion">Discussion</a><ol> </ol></li></ol></nav><div class="content"><h1>X3J13 Issue DEFTYPE-KEY [NIL] [CLARIFICATION/ADDITION]</h1><h2>Related issues</h2><ul><a class="issue-reference" href="../issues/defstruct-constructor-key-mixture.xhtml#issue-defstruct-constructor-key-mixture">DEFSTRUCT-CONSTRUCTOR-KEY-MIXTURE</a></ul><section id="section-References" class="section"><h2 class="section-title">References</h2>CLtL p.50 </section><section id="section-Edit history" class="section"><h2 class="section-title">Edit history</h2>29-Apr-90, Version 1 by Moon 30-Apr-90, Version 2 by Moon (update current practice) 4-May-90, Version 3 by Moon (update from comment received) 9-May-90, Version 4 by Moon (revise according to comments received.  Specifically, remove references to <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-environment">&amp;ENVIRONMENT</a>, take no stand on destructuring, and correct the current practice.) </section><section id="section-Problem description" class="section"><h2 class="section-title">Problem description</h2>  CLtL p.50 only mentions <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-optional">&amp;OPTIONAL</a> and <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-rest">&amp;REST</a> as allowed lambda-list   keywords in <a class="macro-reference" href="../chapter-4.xhtml#macro-deftype">deftype</a>.  It doesn't say whether <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-key">&amp;KEY</a> is allowed too. <br/>  This is Symbolics issue #18. <br/></section><section class="status-unknown proposal" id="issue-deftype-key:allow"><h2 class="section-title">Proposal ALLOW</h2>  Allow <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-optional">&amp;OPTIONAL</a>, <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-rest">&amp;REST</a>, <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-key">&amp;KEY</a>, <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-allow-other-keys">&amp;ALLOW-OTHER-KEYS</a>, and <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-aux">&amp;AUX</a> in the   lambda-list of <a class="macro-reference" href="../chapter-4.xhtml#macro-deftype">deftype</a>. <br/>  Clarify that unsupplied keyword arguments default to *, not <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a>, the same   as unsupplied optional arguments, if no initform is specified in the   lambda-list.  <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-aux">&amp;AUX</a> parameters are initialized to <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a> if no initform is   specified. <br/></section><section id="section-Examples" class="section"><h2 class="section-title">Examples</h2><pre>  <pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-4.xhtml#macro-deftype">deftype</a> <span class="syntax-interned-symbol">xarray</span> <span class="syntax-cons">(<a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-key">&amp;KEY</a> <span class="syntax-interned-symbol">dimensions</span> <span class="syntax-cons">(<span class="syntax-interned-symbol">rank</span> <span class="syntax-quote">'<a class="function-reference" href="../chapter-12.xhtml#function-*">*</a></span> <span class="syntax-interned-symbol">rank-p</span>)</span> <span class="syntax-interned-symbol">element-type</span>)</span>
    <span class="syntax-cons">(<a class="macro-reference" href="../chapter-9.xhtml#macro-check-type">check-type</a> <span class="syntax-interned-symbol">rank</span> <span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-or">or</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-14.xhtml#function-member">member</a> <a class="function-reference" href="../chapter-12.xhtml#function-*">*</a>)</span> <span class="syntax-cons">(<a class="type-reference" href="../chapter-12.xhtml#type-integer">integer</a> <span class="syntax-number">0</span> <a class="function-reference" href="../chapter-12.xhtml#function-*">*</a>)</span>)</span>)</span>
    <span class="syntax-cons">(<a class="macro-reference" href="../chapter-9.xhtml#macro-check-type">check-type</a> <span class="syntax-interned-symbol">dimensions</span> <span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-or">or</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-14.xhtml#function-member">member</a> <a class="function-reference" href="../chapter-12.xhtml#function-*">*</a>)</span> <a class="function-reference" href="../chapter-14.xhtml#function-list">list</a>)</span>)</span>
    <span class="syntax-quasiquote">`<span class="syntax-cons">(<a class="symbol-reference" href="../chapter-2.xhtml#symbol-array">array</a> <span class="syntax-unquote">,<span class="syntax-interned-symbol">element-type</span></span>
            <span class="syntax-unquote">,<span class="syntax-cons">(<a class="special-operator-reference" href="../chapter-5.xhtml#special-operator-if">if</a> <span class="syntax-interned-symbol">rank-p</span> <span class="syntax-interned-symbol">rank</span> <span class="syntax-interned-symbol">dimensions</span>)</span></span>)</span></span>)</span>
</span></code></pre><br/><br/>  <code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-9.xhtml#macro-check-type">check-type</a> <span class="syntax-interned-symbol">z</span> <span class="syntax-cons">(<span class="syntax-interned-symbol">xarray</span> <span class="syntax-keyword-symbol">:rank</span> <span class="syntax-number">2</span> <span class="syntax-keyword-symbol">:element-type</span> <a class="type-reference" href="../chapter-12.xhtml#type-double-float">double-float</a>)</span>)</span>
</span></code><br/><br/>  <pre><code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">define-presentation-type</span> <span class="syntax-interned-symbol">command</span> <span class="syntax-cons">(<a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-key">&amp;KEY</a> <span class="syntax-cons">(<span class="syntax-interned-symbol">command-table</span> <span class="syntax-interned-symbol">*command-table*</span>)</span>)</span>
     <span class="syntax-interned-symbol">....</span>)</span>
</span></code></pre><br/><br/>  define-presentation-type is similar to deftype but defines some<br/>  additional information about use of the type in user interfaces.<br/><br/></pre></section><section id="section-Rationale" class="section"><h2 class="section-title">Rationale</h2>  Type specifiers with keyword arguments are used extensively in CLIM   and CLIM-based applications. <br/>  <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-aux">&amp;AUX</a> is allowed just for completeness. <br/></section><section id="section-Current practice" class="section"><h2 class="section-title">Current practice</h2>  Symbolics Genera 8.0 supports the proposal.   Lucid 3.0.1 signals an error <code><span class="syntax-root"><span class="syntax-cons">(<a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-key">&amp;KEY</a> <a class="function-reference" href="../chapter-5.xhtml#function-not">not</a> <span class="syntax-interned-symbol">allowed</span>)</span>
</span></code> for this example.   Franz Allegro <a class="package-reference" href="../chapter-11.xhtml#package-cl">cl</a> 3.1.beta.22 supports the proposal.   Other implementations were not surveyed. <br/></section><section id="section-Cost to Implementors" class="section"><h2 class="section-title">Cost to Implementors</h2>  Should be small since this simply makes <a class="macro-reference" href="../chapter-4.xhtml#macro-deftype">deftype</a> support the same   lambda-list keywords as <a class="macro-reference" href="../chapter-5.xhtml#macro-defun">defun</a> and <a class="macro-reference" href="../chapter-3.xhtml#macro-lambda">lambda</a> <pre><code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">which</span> <span class="syntax-interned-symbol">suggests</span> <span class="syntax-interned-symbol">an</span>
  <span class="syntax-interned-symbol">implementation</span> <span class="syntax-interned-symbol">technique</span> <span class="syntax-interned-symbol">of</span> <span class="syntax-interned-symbol">inserting</span> <span class="syntax-quote">'<a class="function-reference" href="../chapter-12.xhtml#function-*">*</a></span> <span class="syntax-interned-symbol">where</span> <span class="syntax-interned-symbol">an</span> <span class="syntax-interned-symbol">initform</span> <span class="syntax-interned-symbol">is</span> <a class="function-reference" href="../chapter-5.xhtml#function-not">not</a>
  <span class="syntax-interned-symbol">specified</span> <span class="syntax-interned-symbol">for</span> <span class="syntax-interned-symbol">an</span> <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-optional">&amp;OPTIONAL</a> <a class="macro-reference" href="../chapter-5.xhtml#macro-or">or</a> <span class="syntax-interned-symbol">&amp;keyword</span> <span class="syntax-interned-symbol">argument</span> <a class="macro-reference" href="../chapter-5.xhtml#macro-and">and</a> <span class="syntax-interned-symbol">then</span> <span class="syntax-interned-symbol">making</span> <span class="syntax-interned-symbol">a</span>
  <a class="special-operator-reference" href="../chapter-5.xhtml#special-operator-function">function</a> <span class="syntax-interned-symbol">that</span> <span class="syntax-interned-symbol">is</span> <span class="syntax-interned-symbol">applied</span> <span class="syntax-interned-symbol">to</span> <a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">the</a> <a class="function-reference" href="../chapter-14.xhtml#function-cdr">cdr</a> <span class="syntax-interned-symbol">of</span> <a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">the</a> <a class="symbol-reference" href="../chapter-25.xhtml#symbol-type">type</a> <span class="syntax-interned-symbol">specifier</span>)</span>
</span></code></pre>. <br/></section><section id="section-Cost to Users" class="section"><h2 class="section-title">Cost to Users</h2>  None. <br/></section><section id="section-Cost of non-adoption" class="section"><h2 class="section-title">Cost of non-adoption</h2>  CLIM will not fit into Common Lisp as well.  <a class="macro-reference" href="../chapter-4.xhtml#macro-deftype">deftype</a> will be less   consistent with the rest of the language. <br/></section><section id="section-Performance impact" class="section"><h2 class="section-title">Performance impact</h2>  None. <br/></section><section id="section-Benefits" class="section"><h2 class="section-title">Benefits</h2>  Cost of non-adoption will not be incurred. <br/></section><section id="section-Esthetics" class="section"><h2 class="section-title">Esthetics</h2>  <a class="macro-reference" href="../chapter-4.xhtml#macro-deftype">deftype</a> will be consistent with <a class="macro-reference" href="../chapter-5.xhtml#macro-defun">defun</a>, eliminating an arbitrary   restriction. <br/></section><section id="section-Discussion" class="section"><h2 class="section-title">Discussion</h2>  There has been some discussion about whether <a class="macro-reference" href="../chapter-4.xhtml#macro-deftype">deftype</a> supports   destructuring.  It seems that CLtL pages 50 and 146 may contradict   each other on this point.  This issue explicitly does not address   the question of destructuring. </section></div></main><footer>Copyright © 2021 Jan Moringen</footer></body></html>