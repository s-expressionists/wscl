<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN"
  "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="utf-8"/><link rel="stylesheet" type="text/css" href="../style.css"/><script src="../permalink.js"/><script src="../navigation.js"/><title>Well-specified Common Lisp — NTH-VALUE</title></head><body><main><nav class="sidebar"><span class="name">Entry Points</span><br/><ol><li><a href="../chap-0.xhtml#section-Figures">Table of Contents</a></li><li><a href="../symbol-index.xhtml#section-SymbolIndex">Symbol Index</a></li><li><a href="../figure-index.xhtml#section-FigureIndex">Figure Index</a></li><li><a href="../issue-index.xhtml#section-IssueIndices">Issue Index</a></li><li><a href="../note-indices.xhtml#section-ReviewerNoteIndex">Note Indices</a></li><li><a href="../chapter-26.xhtml#section-Glossary">Glossary</a></li></ol><hr/><span class="name">NTH-VALUE</span><br/><ol class="local-toc"><li><a href="#section-Status">Status</a><ol> </ol></li><li><a href="#section-References">References</a><ol> </ol></li><li><a href="#section-Edit history">Edit history</a><ol> </ol></li><li><a href="#section-Problem description">Problem description</a><ol> </ol></li><li><a href="#issue-nth-value:add">Proposal ADD</a><ol> </ol></li><li><a href="#section-Examples">Examples</a><ol> </ol></li><li><a href="#section-Rationale">Rationale</a><ol> </ol></li><li><a href="#section-Current practice">Current practice</a><ol> </ol></li><li><a href="#section-Cost to Implementors">Cost to Implementors</a><ol> </ol></li><li><a href="#section-Cost to Users">Cost to Users</a><ol> </ol></li><li><a href="#section-Cost of non-Adoption">Cost of non-Adoption</a><ol> </ol></li><li><a href="#section-Benefits">Benefits</a><ol> </ol></li><li><a href="#section-Aesthetics">Aesthetics</a><ol> </ol></li><li><a href="#section-Discussion">Discussion</a><ol> </ol></li></ol></nav><div class="content"><h1>X3J13 Issue NTH-VALUE [NIL] [ADDITION]</h1><section id="section-Status" class="status-passed section"><h2 class="section-title">Status</h2>Passed, as amended, Jan 89 X3J13 </section><section id="section-References" class="section"><h2 class="section-title">References</h2>Multiple values, pp. 133-139 </section><section id="section-Edit history" class="section"><h2 class="section-title">Edit history</h2>16-Aug-88, Version 1 by Pierson 01-Oct-88, Version 2 by Pitman (minor edits) 5-Oct-88, Version 3 by Masinter (add Current Practice as per Gray) 8-Dec-88, Version 4 by Masinter (add comments to discussion) 17-Mar-89, Version 5, Masinter (as amended) </section><section id="section-Problem description" class="section"><h2 class="section-title">Problem description</h2>  The set of operations on multiple values in Common Lisp is incomplete: <br/>  The only ways to retrieve just one of several return values <pre><code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">other</span> <span class="syntax-interned-symbol">than</span>
  <a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">the</a> <a class="function-reference" href="../chapter-14.xhtml#function-first">first</a>)</span>
</span></code></pre> are: <br/>   <a class="function-reference" href="../chapter-12.xhtml#function--">-</a> Bind several variables and then ignore all but one.      eg, <pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-multiple-value-bind">multiple-value-bind</a> <span class="syntax-cons">(<span class="syntax-interned-symbol">X</span> <span class="syntax-interned-symbol">Y</span> <span class="syntax-interned-symbol">Z</span>)</span> <span class="syntax-interned-symbol">&lt;exp&gt;</span> <span class="syntax-cons">(<a class="symbol-reference" href="../chapter-3.xhtml#symbol-declare">declare</a> <span class="syntax-cons">(<a class="declaration-reference" href="../chapter-3.xhtml#declaration-ignore">ignore</a> <span class="syntax-interned-symbol">X</span> <span class="syntax-interned-symbol">Y</span>)</span>)</span> <span class="syntax-interned-symbol">Z</span>)</span>
</span></code></pre>      This is somewhat cumbersome to write and not perspicuous. <br/>   <a class="function-reference" href="../chapter-12.xhtml#function--">-</a> Get a list of all return values and select from that.      eg, <pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-14.xhtml#function-third">third</a> <span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-multiple-value-list">multiple-value-list</a> <span class="syntax-interned-symbol">&lt;exp&gt;</span>)</span>)</span>
</span></code></pre>      This is somewhat cumbersome, not perspicuous, and creates      needless garbage. <br/></section><section class="status-passed proposal" id="issue-nth-value:add"><h2 class="section-title">Proposal ADD</h2>  Add a new macro <a class="macro-reference" href="../chapter-5.xhtml#macro-nth-value">nth-value</a>, described as <br/>  <a class="macro-reference" href="../chapter-5.xhtml#macro-nth-value">nth-value</a> n form                                               [Macro] <br/>  N must be a non-negative integer.   Evaluates the <a class="glossary-reference" href="../chapter-26.xhtml#glossary-form">form</a> and returns the Nth value returned by the form as   a single value.  N is 0-based, i.e. the first returned value is    value 0 <pre><code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">for</span> <span class="syntax-interned-symbol">consistency</span> <span class="syntax-interned-symbol">with</span> <a class="function-reference" href="../chapter-14.xhtml#function-nth">nth</a> <a class="macro-reference" href="../chapter-5.xhtml#macro-and">and</a> <a class="function-reference" href="../chapter-14.xhtml#function-nthcdr">nthcdr</a>)</span>
</span></code></pre>. Both N and <a class="glossary-reference" href="../chapter-26.xhtml#glossary-form">form</a> are   evaluated, in left-to-right order. <br/>  <a class="macro-reference" href="../chapter-5.xhtml#macro-nth-value">nth-value</a> returns <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a> if N is greater than or equal to the number   of values returned by <a class="glossary-reference" href="../chapter-26.xhtml#glossary-form">form</a>. <br/></section><section id="section-Examples" class="section"><h2 class="section-title">Examples</h2><pre>  With this proposal <a class="function-reference" href="../chapter-12.xhtml#function-mod">mod</a> could be defined as:<br/><br/>  <pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-defun">defun</a> <a class="function-reference" href="../chapter-12.xhtml#function-mod">mod</a> <span class="syntax-cons">(<a class="type-reference" href="../chapter-12.xhtml#type-number">number</a> <span class="syntax-interned-symbol">DIVISOR</span>)</span>
    <span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-nth-value">nth-value</a> <span class="syntax-number">1</span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-floor">floor</a> <a class="type-reference" href="../chapter-12.xhtml#type-number">number</a> <span class="syntax-interned-symbol">DIVISOR</span>)</span>)</span>)</span>
</span></code></pre><br/><br/>  The same code would currently be:<br/><br/>  <pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-defun">defun</a> <a class="function-reference" href="../chapter-12.xhtml#function-mod">mod</a> <span class="syntax-cons">(<a class="type-reference" href="../chapter-12.xhtml#type-number">number</a> <span class="syntax-interned-symbol">DIVISOR</span>)</span>
    <span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-multiple-value-bind">multiple-value-bind</a> <span class="syntax-cons">(<span class="syntax-interned-symbol">DIVIDEND</span> <span class="syntax-interned-symbol">REMAINDER</span>)</span>
        <span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-floor">floor</a> <a class="type-reference" href="../chapter-12.xhtml#type-number">number</a> <span class="syntax-interned-symbol">DIVISOR</span>)</span>
      <span class="syntax-cons">(<a class="symbol-reference" href="../chapter-3.xhtml#symbol-declare">declare</a> <span class="syntax-cons">(<a class="declaration-reference" href="../chapter-3.xhtml#declaration-ignore">ignore</a> <span class="syntax-interned-symbol">DIVIDEND</span>)</span>)</span>
      <span class="syntax-interned-symbol">REMAINDER</span>)</span>)</span>
</span></code></pre><br/><br/></pre></section><section id="section-Rationale" class="section"><h2 class="section-title">Rationale</h2>  This corrects the stated problem. <br/></section><section id="section-Current practice" class="section"><h2 class="section-title">Current practice</h2>  The TI Explorer and LMI Lambda have this feature. <br/></section><section id="section-Cost to Implementors" class="section"><h2 class="section-title">Cost to Implementors</h2>  Writing the macro version is fairly straightforward. <br/>  Some will choose to implement compiler hooks so that code written with   <a class="macro-reference" href="../chapter-5.xhtml#macro-nth-value">nth-value</a> will be as efficient as possible. This may involve some   additional work, but presumably nothing major. <br/></section><section id="section-Cost to Users" class="section"><h2 class="section-title">Cost to Users</h2>  This is an upward-compatible change. <br/></section><section id="section-Cost of non-Adoption" class="section"><h2 class="section-title">Cost of non-Adoption</h2>  The occassional code where this comes up may be one or more of    clumsier to write, more difficult to read, or less efficient.   (The feature is rarely used in implementations that have it.) <br/></section><section id="section-Benefits" class="section"><h2 class="section-title">Benefits</h2>  The cost of non-adoption is avoided. <br/></section><section id="section-Aesthetics" class="section"><h2 class="section-title">Aesthetics</h2>  While it does add another function to the language it removes   some need for the hairier multiple-value forms. <br/></section><section id="section-Discussion" class="section"><h2 class="section-title">Discussion</h2>  Pitman proposed this in the very late pre-CLtL days. It was   rejected then because it was too late in the cycle. <br/>  There was not strong sentiment for including this feature   in Common Lisp, but no active opposition. <br/>Comments at the October 1988 X3J13 meeting: <br/>"Trivial, gratuitous." <br/>"Not trivial &ndash; allows index computation. Hard to do this  in a portable, efficient way." <br/>"Says he has an <a class="macro-reference" href="../chapter-5.xhtml#macro-nth-value">nth-value</a> macro for a portable system that he  uses <pre><code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">which</span> <span class="syntax-interned-symbol">exploits</span> <a class="special-operator-reference" href="../chapter-3.xhtml#special-operator-the">the</a> <span class="syntax-interned-symbol">computed</span> <span class="syntax-interned-symbol">index</span> <span class="syntax-interned-symbol">feature</span>)</span>
</span></code></pre> and that it's  a gross kludge in one implementation to make it efficient." </section></div></main><footer>Copyright © 2021 Jan Moringen</footer></body></html>