<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN"
  "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="utf-8"/><link rel="stylesheet" type="text/css" href="../style.css"/><script src="../permalink.js"/><script src="../navigation.js"/><title>Well-specified Common Lisp — FORMAT-COMMA-INTERVAL</title></head><body><main><nav class="sidebar"><span class="name">Entry Points</span><br/><ol><li><a href="../chap-0.xhtml#section-Figures">Table of Contents</a></li><li><a href="../symbol-index.xhtml#section-SymbolIndex">Symbol Index</a></li><li><a href="../figure-index.xhtml#section-FigureIndex">Figure Index</a></li><li><a href="../issue-index.xhtml#section-IssueIndices">Issue Index</a></li><li><a href="../note-indices.xhtml#section-ReviewerNoteIndex">Note Indices</a></li><li><a href="../chapter-26.xhtml#section-Glossary">Glossary</a></li></ol><hr/><span class="name">FORMAT-COMMA-INTERVAL</span><br/><ol class="local-toc"><li><a href="#section-Status">Status</a><ol> </ol></li><li><a href="#section-References">References</a><ol> </ol></li><li><a href="#section-Edit history">Edit history</a><ol> </ol></li><li><a href="#section-Problem description">Problem description</a><ol> </ol></li><li><a href="#issue-format-comma-interval:yes">Proposal YES</a><ol> </ol></li><li><a href="#section-Test Cases">Test Cases</a><ol> </ol></li><li><a href="#section-Rationale">Rationale</a><ol> </ol></li><li><a href="#section-Current practice">Current practice</a><ol> </ol></li><li><a href="#section-Cost to implementors">Cost to implementors</a><ol> </ol></li><li><a href="#section-Cost to users">Cost to users</a><ol> </ol></li><li><a href="#section-Cost of non-adoption">Cost of non-adoption</a><ol> </ol></li><li><a href="#section-Benefits">Benefits</a><ol> </ol></li><li><a href="#section-Esthetics">Esthetics</a><ol> </ol></li><li><a href="#section-Discussion">Discussion</a><ol> </ol></li></ol></nav><div class="content"><h1>X3J13 Issue FORMAT-COMMA-INTERVAL [NIL] [ADDITION]</h1><section id="section-Status" class="status-passed section"><h2 class="section-title">Status</h2>passed, March 88 </section><section id="section-References" class="section"><h2 class="section-title">References</h2><a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> integer printing (p. 388-9) </section><section id="section-Edit history" class="section"><h2 class="section-title">Edit history</h2>Version 1, Pavel, 10-Jun-87 Version 2, Masinter, 15-Jun-87 </section><section id="section-Problem description" class="section"><h2 class="section-title">Problem description</h2>There are times when users would like to print out numbers with some punctuation between groups of digits.  The "commachar" argument to the ~D, ~B, ~O, ~X, and ~R <a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> directives was introduced to fill that need.  Unfortunately, the interval at which the commachar should be printed is always every three digits.  This constraint is annoying when a different interval would be more appropriate. <br/></section><section class="status-passed proposal" id="issue-format-comma-interval:yes"><h2 class="section-title">Proposal YES</h2>Add a fourth argument to the ~D, ~B, ~X, and ~O <a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> directives, and a fifth argument to the ~R directive, to be called the "comma-interval".  This value must be an integer and defaults to 3.  When the : modifier is given to any of these directives, the "commachar" is printed between groups of "comma-interval" digits. <br/></section><section id="section-Test Cases" class="section"><h2 class="section-title">Test Cases</h2><pre>Under the proposal, the following forms return the indicated values:<br/>	<code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a> <span class="syntax-string">"~,,' ,4:B"</span> <span class="syntax-number">13</span>)</span>
</span></code> <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a>&gt; "1101"<br/>	<code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a> <span class="syntax-string">"~,,' ,4:B"</span> <span class="syntax-number">17</span>)</span>
</span></code> <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a>&gt; "1 0001"<br/>	<code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a> <span class="syntax-string">"~19,0,' ,4:B"</span> <span class="syntax-number">3333</span>)</span>
</span></code> <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a>&gt; "0000 1101 0000 0101"<br/>	<code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a> <span class="syntax-string">"~3,,,' ,2:R"</span> <span class="syntax-number">17</span>)</span>
</span></code> <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a>&gt; "1 22"<br/>	(format nil "~,,'|,2:D" #xFFFF) <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a>&gt; "6|55|35"<br/><br/></pre></section><section id="section-Rationale" class="section"><h2 class="section-title">Rationale</h2>The current specification of <a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> gives the user control over almost all of the facets of printing integers.  Only the wired-in constant for the comma-interval remains, even though there are uses for varying that number.  For example, in many contexts, it would be convenient to be able to print out numbers in binary with a space between each group of four bits.  <a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> does not currently allow specification of the commachar printing interval so users needing this functionality must write it themselves, duplicating much of the logic in every implementation's integer printing code.  Other uses, requiring other intervals, can be imagined.  For example, using a "commachar" of #\Newline and a "comma-interval" of, say, 72, very large bignums could be printed in such a way as to ensure line-breaks at appropriate places. <br/></section><section id="section-Current practice" class="section"><h2 class="section-title">Current practice</h2>No released implementations currently support this feature. <br/></section><section id="section-Cost to implementors" class="section"><h2 class="section-title">Cost to implementors</h2>The change in the implementation of <a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> is reasonably minor and, in most cases, highly localized.  Usually, the change is as simple as taking an extra parameter and using it instead of a wired-in value of 3. <br/></section><section id="section-Cost to users" class="section"><h2 class="section-title">Cost to users</h2>Since the proposal involves the addition of an argument to certain directives, the change would be entirely upward-compatible. No user code would need to be converted. <br/></section><section id="section-Cost of non-adoption" class="section"><h2 class="section-title">Cost of non-adoption</h2>Users desiring this functionality will have to write it themselves, duplicating much of the logic involved in printing integers at all. <br/></section><section id="section-Benefits" class="section"><h2 class="section-title">Benefits</h2>One of the few remaining inflexibilities in integer printing is eliminated with a net increase in user-visible functionality. <br/></section><section id="section-Esthetics" class="section"><h2 class="section-title">Esthetics</h2>By parameterizing one of the final pieces of wired-in behavior from integer printing, this small part of the workings of <a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> would be perceived as having been cleaned up. <br/></section><section id="section-Discussion" class="section"><h2 class="section-title">Discussion</h2>Several members of the cleanup committee endorsed this proposal. No objections  </section></div></main><footer>Copyright © 2021 Jan Moringen</footer></body></html>