<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN"
  "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="utf-8"/><link rel="stylesheet" type="text/css" href="../style.css"/><script src="../permalink.js"/><script src="../navigation.js"/><title>Well-specified Common Lisp — IEEE-ATAN-BRANCH-CUT</title></head><body><main><nav class="sidebar"><span class="name">Entry Points</span><br/><ol><li><a href="../chap-0.xhtml#section-Figures">Table of Contents</a></li><li><a href="../symbol-index.xhtml#section-SymbolIndex">Symbol Index</a></li><li><a href="../figure-index.xhtml#section-FigureIndex">Figure Index</a></li><li><a href="../issue-index.xhtml#section-IssueIndices">Issue Index</a></li><li><a href="../note-indices.xhtml#section-ReviewerNoteIndex">Note Indices</a></li><li><a href="../chapter-26.xhtml#section-Glossary">Glossary</a></li></ol><hr/><span class="name">IEEE-ATAN-BRANCH-CUT</span><br/><ol class="local-toc"><li><a href="#section-Status">Status</a><ol> </ol></li><li><a href="#section-References">References</a><ol> </ol></li><li><a href="#section-Edit history">Edit history</a><ol> </ol></li><li><a href="#section-Problem description">Problem description</a><ol> </ol></li><li><a href="#issue-ieee-atan-branch-cut:split">Proposal SPLIT</a><ol> </ol></li><li><a href="#section-Examples">Examples</a><ol> </ol></li><li><a href="#section-Rationale">Rationale</a><ol> </ol></li><li><a href="#section-Current practice">Current practice</a><ol> </ol></li><li><a href="#section-Cost to Implementors">Cost to Implementors</a><ol> </ol></li><li><a href="#section-Cost to Users">Cost to Users</a><ol> </ol></li><li><a href="#section-Cost of non-adoption">Cost of non-adoption</a><ol> </ol></li><li><a href="#section-Benefits">Benefits</a><ol> </ol></li><li><a href="#section-Esthetics">Esthetics</a><ol> </ol></li><li><a href="#section-Discussion">Discussion</a><ol> </ol></li></ol></nav><div class="content"><h1>X3J13 Issue IEEE-ATAN-BRANCH-CUT [Cleanup] [CHANGE]</h1><h2>Related issues</h2><ul><a class="issue-reference" href="../issues/complex-atan-branch-cut.xhtml#issue-complex-atan-branch-cut">COMPLEX-ATAN-BRANCH-CUT</a></ul><section id="section-Status" class="status-passed section"><h2 class="section-title">Status</h2>Passed, Jan 89 X3J13 </section><section id="section-References" class="section"><h2 class="section-title">References</h2>CLtL p.203-214 </section><section id="section-Edit history" class="section"><h2 class="section-title">Edit history</h2>Version 1, 13-Dec-88, Steele Version 2, 11-Jan-89, Masinter  </section><section id="section-Problem description" class="section"><h2 class="section-title">Problem description</h2>If an implementation provides a floating-point minus zero as well as a floating-point plus zero, most notably as in IEEE 754 floating-point arithmetic, then slight adjustments in the branch cuts of transcendental functions are appropriate. <br/>If there is a minus zero and a plus zero, then *no* complex number is actually "on the axis" whether real or imaginary.  Instead, numbers of the form x+0i and x-0i straddle the real axis, and those of the form 0+xi and -0+xi straddle the imginary axis.  Branch cuts that lie on the axes therefore run between such numbers, and directions of continuity are not an issue. <br/></section><section class="status-passed proposal" id="issue-ieee-atan-branch-cut:split"><h2 class="section-title">Proposal SPLIT</h2>Redefine the branch cut for two-argument <a class="function-reference" href="../chapter-12.xhtml#function-atan">atan</a>, covering the cases where there is or is not a minus zero, and then redefine *all* other functions that have branch cuts in terms of two-argument <a class="function-reference" href="../chapter-12.xhtml#function-atan">atan</a>. Specifically, we first define <a class="function-reference" href="../chapter-12.xhtml#function-phase">phase</a> in terms of two-argument <a class="function-reference" href="../chapter-12.xhtml#function-atan">atan</a>, and complex <a class="function-reference" href="../chapter-12.xhtml#function-abs">abs</a> in terms of real <a class="function-reference" href="../chapter-12.xhtml#function-sqrt">sqrt</a> <code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">which</span> <span class="syntax-interned-symbol">has</span> <span class="syntax-interned-symbol">no</span> <span class="syntax-interned-symbol">branch</span> <span class="syntax-interned-symbol">cut</span> <span class="syntax-interned-symbol">problems</span>)</span>
</span></code>; then define complex <a class="function-reference" href="../chapter-12.xhtml#function-log">log</a> in terms of <a class="function-reference" href="../chapter-12.xhtml#function-phase">phase</a>, <a class="function-reference" href="../chapter-12.xhtml#function-abs">abs</a>, and real <a class="function-reference" href="../chapter-12.xhtml#function-log">log</a>; then define complex <a class="function-reference" href="../chapter-12.xhtml#function-sqrt">sqrt</a> in terms of <a class="function-reference" href="../chapter-12.xhtml#function-log">log</a>; and then define all others in terms of these. <br/>In this propoal Lisp expressions should be taken as mathematical formulas that actually are implemented in other ways for improved accuracy. <br/><ol><li> If there is no minus zero, two-argument <a class="function-reference" href="../chapter-12.xhtml#function-atan">atan</a> behaves as in CLtL.  If there is a minus zero, then some cases are modified: </li></ol>	Condition			result 	y=+0  x&gt;0			   +0 	y=-0  x&gt;0			   -0 	y=+0  x&lt;0			   +pi 	y=-0  x&lt;0			   -pi 	y=+0  x=+0			   +0 	y=-0  x=+0			   -0 	y=+0  x=-0			   +pi 	y=-0  x=-0			   -pi     The range of two-argument atan therefore includes -pi in this case. <br/>    Note that the case y=0 x=0 is an error in the absence of minus zero,     but is defined in the presence of minus zero. <br/><code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-number">2</span>)</span>
</span></code> <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-phase">phase</a> <span class="syntax-interned-symbol">X</span>)</span>
</span></code> <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a> <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-atan">atan</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-imagpart">imagpart</a> <span class="syntax-interned-symbol">X</span>)</span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-realpart">realpart</a> <span class="syntax-interned-symbol">X</span>)</span>)</span>
</span></code>, as before, but now     the range of <a class="function-reference" href="../chapter-12.xhtml#function-phase">phase</a> may include -PI if there is a minus zero. <br/><code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-number">3</span>)</span>
</span></code> <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-abs">abs</a> <span class="syntax-interned-symbol">X</span>)</span>
</span></code> <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a> <pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-sqrt">sqrt</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-+">+</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-*">*</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-realpart">realpart</a> <span class="syntax-interned-symbol">X</span>)</span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-realpart">realpart</a> <span class="syntax-interned-symbol">X</span>)</span>)</span>
		       <span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-*">*</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-imagpart">imagpart</a> <span class="syntax-interned-symbol">X</span>)</span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-imagpart">imagpart</a> <span class="syntax-interned-symbol">X</span>)</span>)</span>)</span>)</span>
</span></code></pre>, as before <br/><code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-number">4</span>)</span>
</span></code> <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-log">log</a> <span class="syntax-interned-symbol">X</span>)</span>
</span></code> <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a> <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-complex">complex</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-log">log</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-abs">abs</a> <span class="syntax-interned-symbol">X</span>)</span>)</span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-phase">phase</a> <span class="syntax-interned-symbol">X</span>)</span>)</span>
</span></code> <br/><code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-number">5</span>)</span>
</span></code> <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-sqrt">sqrt</a> <span class="syntax-interned-symbol">X</span>)</span>
</span></code> <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a> <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-exp">exp</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-/">/</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-log">log</a> <span class="syntax-interned-symbol">X</span>)</span> <span class="syntax-number">2</span>)</span>)</span>
</span></code> <br/><code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-number">6</span>)</span>
</span></code> For <a class="function-reference" href="../chapter-12.xhtml#function-expt">expt</a>, <a class="function-reference" href="../chapter-12.xhtml#function-asin">asin</a>, <a class="function-reference" href="../chapter-12.xhtml#function-acos">acos</a>, <a class="function-reference" href="../chapter-12.xhtml#function-atan">atan</a>, <a class="function-reference" href="../chapter-12.xhtml#function-asinh">asinh</a>, <a class="function-reference" href="../chapter-12.xhtml#function-acosh">acosh</a>, <a class="function-reference" href="../chapter-12.xhtml#function-atanh">atanh</a> use the formulas     in CLtL pp. 211-213, but use the formulas <code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">1-5</span>)</span>
</span></code> above as the     definitions of <a class="function-reference" href="../chapter-12.xhtml#function-log">log</a> and <a class="function-reference" href="../chapter-12.xhtml#function-sqrt">sqrt</a> in order to determine the branch cuts     properly. <br/></section><section id="section-Examples" class="section"><h2 class="section-title">Examples</h2><pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-log">log</a> <span class="syntax-number">#c<span class="syntax-symbol">(<span class="syntax-number">-1.0</span> <span class="syntax-number">+0.0</span>)</span></span>)</span>
</span></code> <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a>&gt; #c<code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-number">0.0</span> <span class="syntax-interned-symbol">3.14159...</span>)</span>
</span></code>	;Current<br/><code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-log">log</a> <span class="syntax-number">#c<span class="syntax-symbol">(<span class="syntax-number">-1.0</span> <span class="syntax-number">-0.0</span>)</span></span>)</span>
</span></code> <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a>&gt; #c<code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-number">0.0</span> <span class="syntax-interned-symbol">3.14159...</span>)</span>
</span></code>	;Current<br/><br/><code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-log">log</a> <span class="syntax-number">#c<span class="syntax-symbol">(<span class="syntax-number">-1.0</span> <span class="syntax-number">+0.0</span>)</span></span>)</span>
</span></code> <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a>&gt; #c<code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-number">0.0</span> <span class="syntax-interned-symbol">3.14159...</span>)</span>
</span></code>	;Proposed <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-=">=</a> <span class="syntax-interned-symbol">current</span>)</span>
</span></code><br/><code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-log">log</a> <span class="syntax-number">#c<span class="syntax-symbol">(<span class="syntax-number">-1.0</span> <span class="syntax-number">-0.0</span>)</span></span>)</span>
</span></code> <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a>&gt; #c<code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-number">0.0</span> <span class="syntax-interned-symbol">-3.14159...</span>)</span>
</span></code>	;Proposed <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-12.xhtml#function-conjugate">conjugate</a>)</span>
</span></code><br/><br/></pre></section><section id="section-Rationale" class="section"><h2 class="section-title">Rationale</h2>The current specification ignores some natural consequences of IEEE floating-point arithmetic.  The proposed specification produces results more natural to that arithmetic. <br/>   </section><section id="section-Current practice" class="section"><h2 class="section-title">Current practice</h2>Of implementations that support a minus zero that I have checked, such as Sun-4 <a class="package-reference" href="../chapter-11.xhtml#package-cl">cl</a> 2.1.3 of 10-Nov-88 and Symbolics <a class="package-reference" href="../chapter-11.xhtml#package-cl">cl</a>, all follow the current CLtL specification. <br/>The IEEE trig library atan2 routine written by K.C. Ng (with the advice or supervision of W. Kahan, I believe), and distributed with BSD UNIX (it is file /usr<a class="function-reference" href="../chapter-12.xhtml#function-/">/</a>src/usr.lib/libm/IEEE/atan2.c on my machine) follows this proposal for treatment of minus zero. <br/></section><section id="section-Cost to Implementors" class="section"><h2 class="section-title">Cost to Implementors</h2>Some of the trig routines will require some rewriting.  Probably certain tests that are now written using <a class="function-reference" href="../chapter-12.xhtml#function-zerop">zerop</a> need to be rewritten to use <a class="function-reference" href="../chapter-12.xhtml#function-float-sign">float-sign</a> instead. <br/></section><section id="section-Cost to Users" class="section"><h2 class="section-title">Cost to Users</h2>It is barely conceivable that some user code could depend on this. Probably there is no cost. <br/>The compatibility note on p. 210 of CLtL gave users fair warning that a change of this kind might be adopted. <br/></section><section id="section-Cost of non-adoption" class="section"><h2 class="section-title">Cost of non-adoption</h2>Unnatural treatment of some functions on machines supporting IEEE floating-point arithmetic. <br/></section><section id="section-Benefits" class="section"><h2 class="section-title">Benefits</h2>Natural treatment, etc. <br/></section><section id="section-Esthetics" class="section"><h2 class="section-title">Esthetics</h2>A toss-up, except to those who care. <br/></section><section id="section-Discussion" class="section"><h2 class="section-title">Discussion</h2>Steele has sent a letter to W. Kahan at Berkeley to get any last comments he may have on the matter. </section></div></main><footer>Copyright © 2021 Jan Moringen</footer></body></html>