<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN"
  "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="utf-8"/><link rel="stylesheet" type="text/css" href="../style.css"/><script src="../permalink.js"/><script src="../navigation.js"/><title>Well-specified Common Lisp â€” SHADOW-ALREADY-PRESENT</title></head><body><main><nav class="sidebar"><span class="name">Entry Points</span><br/><ol><li><a href="../chap-0.xhtml#section-Figures">Table of Contents</a></li><li><a href="../symbol-index.xhtml#section-SymbolIndex">Symbol Index</a></li><li><a href="../figure-index.xhtml#section-FigureIndex">Figure Index</a></li><li><a href="../issue-index.xhtml#section-IssueIndices">Issue Index</a></li><li><a href="../note-indices.xhtml#section-ReviewerNoteIndex">Note Indices</a></li><li><a href="../chapter-26.xhtml#section-Glossary">Glossary</a></li></ol><hr/><span class="name">SHADOW-ALREADY-PRESENT</span><br/><ol class="local-toc"><li><a href="#section-References">References</a><ol> </ol></li><li><a href="#section-Edit history">Edit history</a><ol> </ol></li><li><a href="#section-Problem description">Problem description</a><ol> </ol></li><li><a href="#issue-shadow-already-present:works">Proposal WORKS</a><ol> </ol></li><li><a href="#section-Test Case">Test Case</a><ol> </ol></li><li><a href="#section-Rationale">Rationale</a><ol> </ol></li><li><a href="#section-Current practice">Current practice</a><ol> </ol></li><li><a href="#section-Cost to implementors">Cost to implementors</a><ol> </ol></li><li><a href="#section-Cost to users">Cost to users</a><ol> </ol></li><li><a href="#section-Cost of non-adoption">Cost of non-adoption</a><ol> </ol></li><li><a href="#section-Benefits">Benefits</a><ol> </ol></li><li><a href="#section-Esthetics">Esthetics</a><ol> </ol></li><li><a href="#section-Discussion">Discussion</a><ol> </ol></li></ol></nav><div class="content"><h1>X3J13 Issue SHADOW-ALREADY-PRESENT [NIL] [CLARIFICATION/CHANGE]</h1><section id="section-References" class="section"><h2 class="section-title">References</h2>CLtL p.186 </section><section id="section-Edit history" class="section"><h2 class="section-title">Edit history</h2>Version 1 Moon 24 Aug 87  Version 2 Moon 27 Aug 87 incorporate JonL's suggestions  Version 3 Masinter 26-Oct-87 Version 4 Masinter 10-Nov-87 </section><section id="section-Problem description" class="section"><h2 class="section-title">Problem description</h2>The description of the <a class="function-reference" href="../chapter-11.xhtml#function-shadow">SHADOW</a> function can be interpreted as saying that the function has no effect, if the symbol is already present in the package.  This happens if the third sentence in the description <code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-string">"then nothing is done"</span>)</span>
</span></code> is interpreted as applying to the entire description rather than just to the fourth sentence. <br/><a class="function-reference" href="../chapter-11.xhtml#function-shadow">SHADOW</a> is said to take symbols as arguments, however only the print-name is meaningful for this operation <code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">that</span> <span class="syntax-interned-symbol">fact</span> <span class="syntax-interned-symbol">is</span> <span class="syntax-interned-symbol">already</span> <span class="syntax-interned-symbol">documented</span>)</span>
</span></code>. <br/></section><section class="status-unknown proposal" id="issue-shadow-already-present:works"><h2 class="section-title">Proposal WORKS</h2>1) The <a class="function-reference" href="../chapter-11.xhtml#function-shadow">SHADOW</a> function always adds the symbol to the <a class="function-reference" href="../chapter-11.xhtml#function-package-shadowing-symbols">PACKAGE-SHADOWING-SYMBOLS</a> list, even when the symbol is already present in the package.  <br/>2) The first argument to <a class="function-reference" href="../chapter-11.xhtml#function-shadow">SHADOW</a> is allowed to be or contain strings as well as symbols. The specification "the print name of each symbol is extracted" is to be modified accordingly. <br/></section><section id="section-Test Case" class="section"><h2 class="section-title">Test Case</h2><pre>;;; <a class="function-reference" href="../chapter-11.xhtml#function-shadow">SHADOW</a> always adds the symbol to the <a class="function-reference" href="../chapter-11.xhtml#function-package-shadowing-symbols">PACKAGE-SHADOWING-SYMBOLS</a><br/>;;; list of a package<br/><br/><code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-make-package">make-package</a> <span class="syntax-quote">'<span class="syntax-interned-symbol">test-1</span></span>)</span>
</span></code><br/><code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-intern">intern</a> <span class="syntax-string">"TEST"</span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-find-package">find-package</a> <span class="syntax-quote">'<span class="syntax-interned-symbol">test-1</span></span>)</span>)</span>
</span></code><br/><code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-shadow">shadow</a> <span class="syntax-quote">'<span class="syntax-two-package-markers syntax-interned-symbol">test-1::test</span></span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-find-package">find-package</a> <span class="syntax-quote">'<span class="syntax-interned-symbol">test-1</span></span>)</span>)</span>
</span></code><br/><pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-9.xhtml#macro-assert">assert</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-5.xhtml#function-not">not</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-14.xhtml#function-null">null</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-14.xhtml#function-member">member</a> <span class="syntax-quote">'<span class="syntax-two-package-markers syntax-interned-symbol">test-1::test</span></span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-package-shadowing-symbols">package-shadowing-symbols</a>
                                           <span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-find-package">find-package</a> <span class="syntax-quote">'<span class="syntax-interned-symbol">test-1</span></span>)</span>)</span>)</span>)</span>)</span>)</span>
</span></code></pre><br/><br/><code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-make-package">make-package</a> <span class="syntax-quote">'<span class="syntax-interned-symbol">test-2</span></span>)</span>
</span></code><br/><code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-intern">intern</a> <span class="syntax-string">"TEST"</span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-find-package">find-package</a> <span class="syntax-quote">'<span class="syntax-interned-symbol">test-2</span></span>)</span>)</span>
</span></code><br/><code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-export">export</a> <span class="syntax-quote">'<span class="syntax-two-package-markers syntax-interned-symbol">test-2::test</span></span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-find-package">find-package</a> <span class="syntax-quote">'<span class="syntax-interned-symbol">test-2</span></span>)</span>)</span>
</span></code><br/><code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-use-package">use-package</a> <span class="syntax-quote">'<span class="syntax-interned-symbol">test-2</span></span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-find-package">find-package</a> <span class="syntax-quote">'<span class="syntax-interned-symbol">test-1</span></span>)</span>)</span>
</span></code>    ;should not error<br/><br/>;;; To test the use of strings in place of symbols<br/>;;; change the third line of the test case to<br/>;;;     <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-shadow">shadow</a> <span class="syntax-string">"TEST"</span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-find-package">find-package</a> <span class="syntax-quote">'<span class="syntax-interned-symbol">test-1</span></span>)</span>)</span>
</span></code><br/>;;; Note the use of capital letters in the string.<br/><br/></pre></section><section id="section-Rationale" class="section"><h2 class="section-title">Rationale</h2>CLtL p. 180 describes a name conflict problem that can occur when calling the function <a class="function-reference" href="../chapter-11.xhtml#function-use-package">USE-PACKAGE</a>. The name conflict is between a symbol directly present in the using package and an external symbol of the used package. This name conflict may be resolved in favor of the symbol directly present in the using package by making it a shadowing symbol. For this to work, <a class="function-reference" href="../chapter-11.xhtml#function-shadow">SHADOW</a> must add the symbol to the <a class="function-reference" href="../chapter-11.xhtml#function-package-shadowing-symbols">PACKAGE-SHADOWING-SYMBOLS</a> list even when it is already present in the package. <br/>Since only the print name of a symbol argument is meaningful, a string should also be accepted.  This is particularly useful to avoid problems when compiling code in one package environment and loading it into a slightly different package environment, where the symbol that was referred to at compile time may not be present at load time.  This is particularly important because the symbol referred to by the print name may be changed by evaluation of the <a class="function-reference" href="../chapter-11.xhtml#function-shadow">SHADOW</a> form.  A close reading of CLtL shows that one can already use (shadow '#:bar) in place of <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-shadow">shadow</a> <span class="syntax-quote">'<span class="syntax-interned-symbol">bar</span></span>)</span>
</span></code>, to achieve much the same effect as <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-11.xhtml#function-shadow">shadow</a> <span class="syntax-string">"BAR"</span>)</span>
</span></code>.  But the user should not have to play such games, strings should be accepted. <br/></section><section id="section-Current practice" class="section"><h2 class="section-title">Current practice</h2>Symbolics and Spice Lisp add the symbol to the <a class="function-reference" href="../chapter-11.xhtml#function-package-shadowing-symbols">PACKAGE-SHADOWING-SYMBOLS</a> list, even when the symbol is already present in the package.  Kyoto Common Lisp, Lucid Common Lisp, and Xerox Common Lisp ignore <a class="function-reference" href="../chapter-11.xhtml#function-shadow">SHADOW</a> when the symbol is already present in the package.  It seems likely that we will find several implementations in each camp. <br/><a class="function-reference" href="../chapter-11.xhtml#function-shadow">SHADOW</a> accepts strings in Symbolics Common Lisp. <br/></section><section id="section-Cost to implementors" class="section"><h2 class="section-title">Cost to implementors</h2>This should be a minor change to implementations that do not currently work this way. <br/></section><section id="section-Cost to users" class="section"><h2 class="section-title">Cost to users</h2>Technically this would be an incompatible change to implementations that do not already behave as proposed, however it is difficult to conceive of a user program that would require any conversion to cope with the change. Some users might want to remove kludges that were only necessary to get around the former misbehavior of <a class="function-reference" href="../chapter-11.xhtml#function-shadow">SHADOW</a>. <br/></section><section id="section-Cost of non-adoption" class="section"><h2 class="section-title">Cost of non-adoption</h2>Inconsistency among implementations and lack of a clear way to resolve the name conflict mentioned in Rationale. <br/></section><section id="section-Benefits" class="section"><h2 class="section-title">Benefits</h2>Consistency among implementations and fewer mysterious package problems. <br/></section><section id="section-Esthetics" class="section"><h2 class="section-title">Esthetics</h2>The proposal would remove an unnecessary special case, thus simplifying the language slightly. <br/></section><section id="section-Discussion" class="section"><h2 class="section-title">Discussion</h2>The issue was raised by Dieter Kolb on the <a class="package-reference" href="../chapter-1.xhtml#package-common-lisp">Common-Lisp</a> mailing list. <br/>It would be useless for <a class="function-reference" href="../chapter-11.xhtml#function-shadow">SHADOW</a> to fail to put a symbol that is already present in the package onto the <a class="function-reference" href="../chapter-11.xhtml#function-package-shadowing-symbols">PACKAGE-SHADOWING-SYMBOLS</a> list.  Moon believes CLtL intended to describe what is being proposed, but unfortunately used ambiguous language. <br/>The cleanup committee endorses this proposal. <br/></section></div></main><footer>Copyright Â© 2021 Jan Moringen</footer></body></html>