<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN"
  "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="utf-8"/><link rel="stylesheet" type="text/css" href="../style.css"/><script src="../permalink.js"/><script src="../navigation.js"/><title>Well-specified Common Lisp — DEFVAR-INIT-TIME</title></head><body><main><nav class="sidebar"><span class="name">Entry Points</span><br/><ol><li><a href="../chap-0.xhtml#section-Figures">Table of Contents</a></li><li><a href="../symbol-index.xhtml#section-SymbolIndex">Symbol Index</a></li><li><a href="../figure-index.xhtml#section-FigureIndex">Figure Index</a></li><li><a href="../issue-index.xhtml#section-IssueIndices">Issue Index</a></li><li><a href="../note-indices.xhtml#section-ReviewerNoteIndex">Note Indices</a></li><li><a href="../chapter-26.xhtml#section-Glossary">Glossary</a></li></ol><hr/><span class="name">DEFVAR-INIT-TIME</span><br/><ol class="local-toc"><li><a href="#section-Status">Status</a><ol> </ol></li><li><a href="#section-References">References</a><ol> </ol></li><li><a href="#section-Edit history">Edit history</a><ol> </ol></li><li><a href="#section-Problem Description">Problem Description</a><ol> </ol></li><li><a href="#issue-defvar-init-time:not-delayed">Proposal NOT-DELAYED</a><ol> </ol></li><li><a href="#section-Rationale">Rationale</a><ol> </ol></li><li><a href="#section-Current Practice">Current Practice</a><ol> </ol></li><li><a href="#section-Adoption Cost">Adoption Cost</a><ol> </ol></li><li><a href="#section-Benefits">Benefits</a><ol> </ol></li><li><a href="#section-Conversion Cost">Conversion Cost</a><ol> </ol></li><li><a href="#section-Aesthetics">Aesthetics</a><ol> </ol></li><li><a href="#section-Discussion">Discussion</a><ol> </ol></li></ol></nav><div class="content"><h1>X3J13 Issue DEFVAR-INIT-TIME [NIL] [CLARIFICATION]</h1><section id="section-Status" class="status-passed section"><h2 class="section-title">Status</h2>Passed, Jun 1987 </section><section id="section-References" class="section"><h2 class="section-title">References</h2><a class="macro-reference" href="../chapter-5.xhtml#macro-defvar">DEFVAR</a> (p68) </section><section id="section-Edit history" class="section"><h2 class="section-title">Edit history</h2>23-Apr-87, Version 1 by Pitman 29-Mar-87, Version 2 by Masinter <br/></section><section id="section-Problem Description" class="section"><h2 class="section-title">Problem Description</h2>The description of <a class="macro-reference" href="../chapter-5.xhtml#macro-defvar">DEFVAR</a> is not completely clear about the time at which the initialization occurs. <br/>On p68 it says ``<a class="symbol-reference" href="../chapter-25.xhtml#symbol-variable">VARIABLE</a> is initialized to the result of evaluating the form INITIAL-VALUE unless it already has a value. The INITIAL-VALUE form is not evaluated unless it is used; this fact is useful if evaluation of the INITIAL-VALUE form does something expensive like create a large data structure.'' <br/>At least one implementation interpreted the "unless it is used" to mean "unless the variable is used" rather than "unless the initial-value is to be used". The problem is that the "it" is ambiguous. Thus, <a class="macro-reference" href="../chapter-5.xhtml#macro-defvar">DEFVAR</a> was interpreted as a kind of lazy initialization that happened upon the variable's first unbound reference. (This interpretation appears to have been further supported by the additional wording in CLtL about not creating expensive structures that are not needed.) <br/></section><section class="status-passed proposal" id="issue-defvar-init-time:not-delayed"><h2 class="section-title">Proposal NOT-DELAYED</h2>Clarify that the evaluation of the initial value and the initialization happen at <a class="macro-reference" href="../chapter-5.xhtml#macro-defvar">DEFVAR</a> execution time <code><span class="syntax-root"><span class="syntax-cons">(<a class="special-operator-reference" href="../chapter-5.xhtml#special-operator-if">if</a> <span class="syntax-interned-symbol">at</span> <span class="syntax-interned-symbol">all</span>)</span>
</span></code>. The cause of the confusion is the statement that the initial value form is not evaluated unless "it is used".  Better to say that INITIAL-VALUE is evaluated if and only if the variable does not already have a value.  Then there would be no confusion about the time of evaluation. <br/></section><section id="section-Rationale" class="section"><h2 class="section-title">Rationale</h2>This clarification follows the intent of the original Common Lisp designers. <br/></section><section id="section-Current Practice" class="section"><h2 class="section-title">Current Practice</h2>Nearly all implementations implement the proposed interpretation. <br/></section><section id="section-Adoption Cost" class="section"><h2 class="section-title">Adoption Cost</h2>None, for most implementations; very small for any the implementation that adopted delayed evaluation. <br/></section><section id="section-Benefits" class="section"><h2 class="section-title">Benefits</h2>This clarification makes the semantics of an important primitive more well-defined. <br/></section><section id="section-Conversion Cost" class="section"><h2 class="section-title">Conversion Cost</h2>Most users presumably expect the behavior currently in practice in most dialects. There's not a lot of code where the difference comes into play anyway. Presumably the conversion cost is fairly trivial. <br/></section><section id="section-Aesthetics" class="section"><h2 class="section-title">Aesthetics</h2>Being a clarification, this really doesn't have much aesthetic effect. <br/></section><section id="section-Discussion" class="section"><h2 class="section-title">Discussion</h2>The cleanup committee supports this clarification. </section></div></main><footer>Copyright © 2021 Jan Moringen</footer></body></html>