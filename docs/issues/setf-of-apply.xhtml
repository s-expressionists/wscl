<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN"
  "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="utf-8"/><link rel="stylesheet" type="text/css" href="../style.css"/><script src="../permalink.js"/><script src="../navigation.js"/><title>Well-specified Common Lisp â€” SETF-OF-APPLY</title></head><body><main><nav class="sidebar"><span class="name">Entry Points</span><br/><ol><li><a href="../chap-0.xhtml#section-Figures">Table of Contents</a></li><li><a href="../symbol-index.xhtml#section-SymbolIndex">Symbol Index</a></li><li><a href="../figure-index.xhtml#section-FigureIndex">Figure Index</a></li><li><a href="../issue-index.xhtml#section-IssueIndices">Issue Index</a></li><li><a href="../note-indices.xhtml#section-ReviewerNoteIndex">Note Indices</a></li><li><a href="../chapter-26.xhtml#section-Glossary">Glossary</a></li></ol><hr/><span class="name">SETF-OF-APPLY</span><br/><ol class="local-toc"><li><a href="#section-References">References</a><ol> </ol></li><li><a href="#section-Edit history">Edit history</a><ol> </ol></li><li><a href="#section-Problem description">Problem description</a><ol> </ol></li><li><a href="#issue-setf-of-apply:only-aref-and-friends">Proposal ONLY-AREF-AND-FRIENDS</a><ol> </ol></li><li><a href="#section-Rationale">Rationale</a><ol> </ol></li><li><a href="#section-Current Practice">Current Practice</a><ol> </ol></li><li><a href="#section-Cost to Implementors">Cost to Implementors</a><ol> </ol></li><li><a href="#section-Cost to Users">Cost to Users</a><ol> </ol></li><li><a href="#section-Cost of non-adoption">Cost of non-adoption</a><ol> </ol></li><li><a href="#section-Performance impact">Performance impact</a><ol> </ol></li><li><a href="#section-Benefits">Benefits</a><ol> </ol></li><li><a href="#section-Esthetics">Esthetics</a><ol> </ol></li><li><a href="#section-Discussion">Discussion</a><ol> </ol></li></ol></nav><div class="content"><h1>X3J13 Issue SETF-OF-APPLY [NIL] [CLARIFICATION]</h1><h2>Related issues</h2><ul><li><a class="issue-reference" href="../issues/setf-functions-again.xhtml#issue-setf-functions-again">SETF-FUNCTIONS-AGAIN</a></li></ul><section id="section-References" class="section"><h2 class="section-title">References</h2><a class="macro-reference" href="../chapter-5.xhtml#macro-setf">SETF</a> </section><section id="section-Edit history" class="section"><h2 class="section-title">Edit history</h2>V1, 10 May 90, Sandra Loosemore V2, 29 May 90, Sandra Loosemore (forgot <a class="function-reference" href="../chapter-15.xhtml#function-bit">BIT</a> &amp; <a class="function-reference" href="../chapter-15.xhtml#function-sbit">SBIT</a>) <br/></section><section id="section-Problem description" class="section"><h2 class="section-title">Problem description</h2>CLtL requires that <code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-setf">SETF</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-5.xhtml#function-apply">APPLY</a> <span class="syntax-function">#'<span class="syntax-interned-symbol">foo</span></span> <span class="syntax-interned-symbol">...</span>)</span>)</span>
</span></code> can be used only for places "foo" whose <a class="macro-reference" href="../chapter-5.xhtml#macro-setf">SETF</a> expansion is implemented in such a way that the last subform of the accessing form appears as the last argument of the storing call.  The discussion and example imply that the <a class="macro-reference" href="../chapter-5.xhtml#macro-setf">SETF</a> method for <a class="function-reference" href="../chapter-15.xhtml#function-aref">AREF</a> is required to implemented in this way.  Are  there any other <a class="macro-reference" href="../chapter-5.xhtml#macro-setf">SETF</a> places defined in the standard that are required to be usable with <a class="function-reference" href="../chapter-5.xhtml#function-apply">APPLY</a>? <br/>This is Loosemore's issue #28. <br/></section><section class="status-unknown proposal" id="issue-setf-of-apply:only-aref-and-friends"><h2 class="section-title">Proposal ONLY-AREF-AND-FRIENDS</h2>  Require that <code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-setf">SETF</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-5.xhtml#function-apply">APPLY</a> <span class="syntax-function">#'<span class="syntax-interned-symbol">&lt;place&gt;</span></span> <span class="syntax-interned-symbol">...</span>)</span> <span class="syntax-interned-symbol">...</span>)</span>
</span></code> work for the standard   &lt;place&gt;s <a class="function-reference" href="../chapter-15.xhtml#function-aref">AREF</a>, <a class="function-reference" href="../chapter-15.xhtml#function-bit">BIT</a>, and <a class="function-reference" href="../chapter-15.xhtml#function-sbit">SBIT</a>, but document that the consequences of   using any of the other standard <a class="macro-reference" href="../chapter-5.xhtml#macro-setf">SETF</a> &lt;place&gt;s with <a class="function-reference" href="../chapter-5.xhtml#function-apply">APPLY</a> are   undefined.   <br/>  This proposal does not change the behavior of <code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-setf">SETF</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-5.xhtml#function-apply">APPLY</a> <span class="syntax-interned-symbol">...</span>)</span>)</span>
</span></code>    with user-defined <a class="macro-reference" href="../chapter-5.xhtml#macro-setf">SETF</a> methods; any <a class="macro-reference" href="../chapter-5.xhtml#macro-setf">SETF</a> methods that are defined    by the user in such a way that the last subform of the accessing    form appears as the last argument of the storing call continue   to work with <a class="macro-reference" href="../chapter-5.xhtml#macro-setf">SETF</a> of <a class="function-reference" href="../chapter-5.xhtml#function-apply">APPLY</a>. <br/></section><section id="section-Rationale" class="section"><h2 class="section-title">Rationale</h2>  Of all the standard <a class="macro-reference" href="../chapter-5.xhtml#macro-setf">SETF</a> places, <a class="function-reference" href="../chapter-15.xhtml#function-aref">AREF</a>, <a class="function-reference" href="../chapter-15.xhtml#function-bit">BIT</a>, and <a class="function-reference" href="../chapter-15.xhtml#function-sbit">SBIT</a> appear to be    the only functions that are defined with <a class="lambda-list-keyword-reference" href="../chapter-3.xhtml#lambda-list-keyword-rest">&amp;REST</a> arguments and where    one might have a real need to use them with <a class="function-reference" href="../chapter-5.xhtml#function-apply">APPLY</a>.  Not requiring    <code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-setf">SETF</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-5.xhtml#function-apply">APPLY</a> <span class="syntax-function">#'<a class="function-reference" href="../chapter-15.xhtml#function-aref">AREF</a></span> <span class="syntax-interned-symbol">...</span>)</span> <span class="syntax-interned-symbol">...</span>)</span>
</span></code> to work might be seen as an   incompatible change to the language since CLtL implies that it   is legitimate.  <a class="function-reference" href="../chapter-15.xhtml#function-bit">BIT</a> and <a class="function-reference" href="../chapter-15.xhtml#function-sbit">SBIT</a> are very similar to <a class="function-reference" href="../chapter-15.xhtml#function-aref">AREF</a>.  Requiring    other <a class="macro-reference" href="../chapter-5.xhtml#macro-setf">SETF</a> places to work with <a class="function-reference" href="../chapter-5.xhtml#function-apply">APPLY</a> might be seen as putting    unnecessary restrictions on implementors. <br/></section><section id="section-Current Practice" class="section"><h2 class="section-title">Current Practice</h2>   Unknown. <br/></section><section id="section-Cost to Implementors" class="section"><h2 class="section-title">Cost to Implementors</h2>   Probably small.  At most, you'd have to provide a new    definition for the <a class="macro-reference" href="../chapter-5.xhtml#macro-setf">SETF</a> method for <a class="function-reference" href="../chapter-15.xhtml#function-aref">AREF</a> and friends, or write some    special-case handling for these places in the <a class="macro-reference" href="../chapter-5.xhtml#macro-setf">SETF</a> method for <a class="function-reference" href="../chapter-5.xhtml#function-apply">APPLY</a>. <br/></section><section id="section-Cost to Users" class="section"><h2 class="section-title">Cost to Users</h2>   Probably none.  Any programs that rely on using <a class="macro-reference" href="../chapter-5.xhtml#macro-setf">SETF</a> of <a class="function-reference" href="../chapter-5.xhtml#function-apply">APPLY</a>    with other standard <a class="macro-reference" href="../chapter-5.xhtml#macro-setf">SETF</a> places are almost certainly    nonportable anyway. <br/></section><section id="section-Cost of non-adoption" class="section"><h2 class="section-title">Cost of non-adoption</h2>   The language specification is unclear on this point. <br/></section><section id="section-Performance impact" class="section"><h2 class="section-title">Performance impact</h2>   Probably none. <br/></section><section id="section-Benefits" class="section"><h2 class="section-title">Benefits</h2>   The language specification is made more clear. <br/></section><section id="section-Esthetics" class="section"><h2 class="section-title">Esthetics</h2>   Ugly. <br/></section><section id="section-Discussion" class="section"><h2 class="section-title">Discussion</h2>Loosemore isn't really satisfied with proposal <a class="proposal-reference" href="#issue-setf-of-apply:only-aref-and-friends">ONLY-AREF-AND-FRIENDS</a>. It is probably closest to the status quo, but it seems like an overly complicated and messy way of dealing with a few special cases. <br/>From a purely esthetic point of view, it would be much cleaner to require that the <a class="macro-reference" href="../chapter-5.xhtml#macro-setf">SETF</a> method for <a class="function-reference" href="../chapter-15.xhtml#function-aref">AREF</a> be implemented by a  function <code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-setf">SETF</a> <a class="function-reference" href="../chapter-15.xhtml#function-aref">AREF</a>)</span>
</span></code> and then either remove the SETF-of-APPLY feature completely or redefine it so that     <code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-setf">SETF</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-5.xhtml#function-apply">APPLY</a> <span class="syntax-function">#'<span class="syntax-interned-symbol">&lt;name&gt;</span></span> <span class="syntax-symbol">.</span> <span class="syntax-interned-symbol">&lt;args&gt;</span>)</span> <span class="syntax-interned-symbol">&lt;value&gt;</span>)</span>
</span></code> is equivalent to     <code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-5.xhtml#function-apply">APPLY</a> <span class="syntax-function">#'<span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-setf">SETF</a> <span class="syntax-interned-symbol">&lt;name&gt;</span>)</span></span> <span class="syntax-interned-symbol">&lt;value&gt;</span> <span class="syntax-symbol">.</span> <span class="syntax-interned-symbol">&lt;args&gt;</span>)</span>
</span></code> except for preserving the left-to-right order of evaluation of the original call.  This kind of change might be seen as too much of a restriction on implementors and too major to be considered at this point, however.  See <a class="issue-reference" href="../issues/setf-functions-again.xhtml#issue-setf-functions-again">X3J13 Issue SETF-FUNCTIONS-AGAIN</a>. </section></div></main><footer>Copyright Â© 2021 Jan Moringen</footer></body></html>