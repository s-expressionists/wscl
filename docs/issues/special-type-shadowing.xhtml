<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN"
  "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="utf-8"/><link rel="stylesheet" type="text/css" href="../style.css"/><script src="../permalink.js"/><script src="../navigation.js"/><title>Well-specified Common Lisp — SPECIAL-TYPE-SHADOWING</title></head><body><main><nav class="sidebar"><span class="name">Entry Points</span><br/><ol><li><a href="../chap-0.xhtml#section-Figures">Table of Contents</a></li><li><a href="../symbol-index.xhtml#section-SymbolIndex">Symbol Index</a></li><li><a href="../figure-index.xhtml#section-FigureIndex">Figure Index</a></li><li><a href="../issue-index.xhtml#section-IssueIndices">Issue Index</a></li><li><a href="../note-indices.xhtml#section-ReviewerNoteIndex">Note Indices</a></li><li><a href="../chapter-26.xhtml#section-Glossary">Glossary</a></li></ol><hr/><span class="name">SPECIAL-TYPE-SHADOWING</span><br/><ol class="local-toc"><li><a href="#section-Status">Status</a><ol> </ol></li><li><a href="#section-References">References</a><ol> </ol></li><li><a href="#section-Edit history">Edit history</a><ol> </ol></li><li><a href="#section-Problem description">Problem description</a><ol> </ol></li><li><a href="#issue-special-type-shadowing:clarify">Proposal CLARIFY</a><ol> </ol></li><li><a href="#section-Rationale">Rationale</a><ol> </ol></li><li><a href="#section-Current practice">Current practice</a><ol> </ol></li><li><a href="#section-Cost to Implementors">Cost to Implementors</a><ol> </ol></li><li><a href="#section-Cost to Users">Cost to Users</a><ol> </ol></li><li><a href="#section-Cost of non-adoption">Cost of non-adoption</a><ol> </ol></li><li><a href="#section-Performance impact">Performance impact</a><ol> </ol></li><li><a href="#section-Benefits">Benefits</a><ol> </ol></li><li><a href="#section-Discussion">Discussion</a><ol> </ol></li></ol></nav><div class="content"><h1>X3J13 Issue SPECIAL-TYPE-SHADOWING [NIL] [CLARIFICATION]</h1><h2>Related issues</h2><ul><span class="issue-reference error">issue:DECLARE-TYPE-FREE</span></ul><section id="section-Status" class="status-passed section"><h2 class="section-title">Status</h2>Passed, Jan 89 X3J13 </section><section id="section-References" class="section"><h2 class="section-title">References</h2>CLtL pages 156, 158 </section><section id="section-Edit history" class="section"><h2 class="section-title">Edit history</h2>Version 1, 04-Nov-88 by David Gray </section><section id="section-Problem description" class="section"><h2 class="section-title">Problem description</h2>  A Common Lisp user raised the question of whether something like the   following is legal: <br/>    <pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-3.xhtml#function-proclaim">proclaim</a> <span class="syntax-quote">'<span class="syntax-cons">(<a class="symbol-reference" href="../chapter-25.xhtml#symbol-type">type</a> <a class="type-reference" href="../chapter-12.xhtml#type-number">number</a> <span class="syntax-interned-symbol">*X*</span>)</span></span>)</span>
</span></code></pre>     <pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-defvar">defvar</a> <span class="syntax-interned-symbol">*X*</span>)</span>
</span></code></pre>     <pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="macro-reference" href="../chapter-5.xhtml#macro-defun">defun</a> <span class="syntax-interned-symbol">FOO</span> <span class="syntax-symbol">()</span>
      <span class="syntax-cons">(<a class="special-operator-reference" href="../chapter-5.xhtml#special-operator-let">let</a> <span class="syntax-cons">(<span class="syntax-cons">(<span class="syntax-interned-symbol">*X*</span> <a class="section-reference" href="../chapter-26.xhtml#section-T">T</a>)</span>)</span>
        <span class="syntax-cons">(<a class="symbol-reference" href="../chapter-3.xhtml#symbol-declare">declare</a> <span class="syntax-cons">(<a class="symbol-reference" href="../chapter-25.xhtml#symbol-type">type</a> <a class="symbol-reference" href="../chapter-2.xhtml#symbol-symbol">symbol</a> <span class="syntax-interned-symbol">*X*</span>)</span>)</span>
        <span class="syntax-cons">(<span class="syntax-interned-symbol">BAR</span>)</span>)</span>)</span>
</span></code></pre> <br/>  Page 156 of CLtL says that a proclamation is "always in force unless   locally shadowed" and page 158 says type declarations "only affect   variable bindings", which might be interpreted to mean that the <a class="symbol-reference" href="../chapter-3.xhtml#symbol-declare">declare</a>   locally shadows the <a class="function-reference" href="../chapter-3.xhtml#function-proclaim">proclaim</a>.  However, that interpretation would make   the global type proclamation useless because it could not be relied on   when compiling a function such as <a class="index/code-reference" href="../chapter-1.xhtml#index/code-bar">bar</a>.  <br/></section><section class="status-passed proposal" id="issue-special-type-shadowing:clarify"><h2 class="section-title">Proposal CLARIFY</h2>  Clarify that if there is a local type declaration for a special   variable, and there is also a global type proclamation for that same   variable, then the value of the variable within the scope of the local   declaration must be a member of the intersection of the two declared   types. <br/></section><section id="section-Rationale" class="section"><h2 class="section-title">Rationale</h2>  Some restriction on local type declarations for special variables is   needed in order for type proclamations to be meaningful.  The wording   used here was chosen for consistency with proposal DECLARE-TYPE-FREE. <br/></section><section id="section-Current practice" class="section"><h2 class="section-title">Current practice</h2>  The TI, Symbolics, and Lucid implementations do not report any error   on the example above, but it isn't clear that they really do anything   with type declarations for special variables anyway. <br/></section><section id="section-Cost to Implementors" class="section"><h2 class="section-title">Cost to Implementors</h2>  This is unlikely to require a change in any current implementation. <br/></section><section id="section-Cost to Users" class="section"><h2 class="section-title">Cost to Users</h2>  Anyone who has written code like the example above would have to   modify it if compilers started enforcing this restriction. <br/></section><section id="section-Cost of non-adoption" class="section"><h2 class="section-title">Cost of non-adoption</h2>  A minor ambiguity in the language specification that could confuse   users. <br/></section><section id="section-Performance impact" class="section"><h2 class="section-title">Performance impact</h2>  None. <br/></section><section id="section-Benefits" class="section"><h2 class="section-title">Benefits</h2>  A clearer definition of the meaning of type declarations for special   variables. <br/></section><section id="section-Discussion" class="section"><h2 class="section-title">Discussion</h2>  This is obviously very closely related to <span class="issue-reference error">issue:Issue DECLARE-TYPE-FREE</span>, but   this is an ambiguity in the existing language that should be resolved   even if the language extension of proposal DECLARE-TYPE-FREE is not   accepted.  Note also that DECLARE-TYPE-FREE makes no mention of type   proclamations. <br/>  Other possible resolutions of the ambiguity would be to either rule   out use of local type declarations for special variables, or to say   that the local type must be a subtype of the global type. </section></div></main><footer>Copyright © 2021 Jan Moringen</footer></body></html>