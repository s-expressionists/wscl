<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN"
  "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="utf-8"/><link rel="stylesheet" type="text/css" href="../style.css"/><script src="../permalink.js"/><script src="../navigation.js"/><title>Well-specified Common Lisp — FORMAT-PRETTY-PRINT</title></head><body><main><nav class="sidebar"><span class="name">Entry Points</span><br/><ol><li><a href="../chap-0.xhtml#section-Figures">Table of Contents</a></li><li><a href="../symbol-index.xhtml#section-SymbolIndex">Symbol Index</a></li><li><a href="../figure-index.xhtml#section-FigureIndex">Figure Index</a></li><li><a href="../issue-index.xhtml#section-IssueIndices">Issue Index</a></li><li><a href="../note-indices.xhtml#section-ReviewerNoteIndex">Note Indices</a></li><li><a href="../chapter-26.xhtml#section-Glossary">Glossary</a></li></ol><hr/><span class="name">FORMAT-PRETTY-PRINT</span><br/><ol class="local-toc"><li><a href="#section-Status">Status</a><ol> </ol></li><li><a href="#section-References">References</a><ol> </ol></li><li><a href="#section-Edit history">Edit history</a><ol> </ol></li><li><a href="#section-Problem description">Problem description</a><ol> </ol></li><li><a href="#issue-format-pretty-print:yes">Proposal YES</a><ol> </ol></li><li><a href="#section-Test Cases/Examples">Test Cases/Examples</a><ol> </ol></li><li><a href="#section-Rationale">Rationale</a><ol> </ol></li><li><a href="#section-Current practice">Current practice</a><ol> </ol></li><li><a href="#section-Cost to Implementors">Cost to Implementors</a><ol> </ol></li><li><a href="#section-Cost to Users">Cost to Users</a><ol> </ol></li><li><a href="#section-Cost of non-Adoption">Cost of non-Adoption</a><ol> </ol></li><li><a href="#section-Benefits">Benefits</a><ol> </ol></li><li><a href="#section-Aesthetics">Aesthetics</a><ol> </ol></li><li><a href="#section-Discussion">Discussion</a><ol> </ol></li></ol></nav><div class="content"><h1>X3J13 Issue FORMAT-PRETTY-PRINT [NIL] [CLARIFICATION]</h1><section id="section-Status" class="status-passed section"><h2 class="section-title">Status</h2>Passed, Jan 89 X3J13 </section><section id="section-References" class="section"><h2 class="section-title">References</h2><a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> (pp. 385-388), <a class="function-reference" href="../chapter-22.xhtml#function-prin1">prin1</a> (p. 83), <a class="function-reference" href="../chapter-22.xhtml#function-princ">princ</a> (p. 83), <a class="function-reference" href="../chapter-22.xhtml#function-write">write</a> (p. 382), <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-pretty*">*print-pretty*</a> (p. 371) </section><section id="section-Edit history" class="section"><h2 class="section-title">Edit history</h2>Version 1 by Pierson 3/4/88 Version 2 by Pierson 5/24/88 (fix name typo) Version 3 by Pierson 6/10/88 incorporate comments Version 4 by Pierson 6/10/88 comments from Van Roggen Version 5 by Masinter  2-Oct-88 Version 6 by Pierson 11/10/88 final nits Version 7 by Pierson 11/15/88 "does" <a class="function-reference" href="../chapter-12.xhtml#function-=">=</a>&gt; "does not" </section><section id="section-Problem description" class="section"><h2 class="section-title">Problem description</h2>The <a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> operators, ~A and ~S are defined to print their argument as <a class="function-reference" href="../chapter-22.xhtml#function-princ">princ</a> and <a class="function-reference" href="../chapter-22.xhtml#function-prin1">prin1</a> respectively.  The text does not say whether or not these <a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> operators must obey the <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-pretty*">*print-pretty*</a> flag. <br/></section><section class="status-passed proposal" id="issue-format-pretty-print:yes"><h2 class="section-title">Proposal YES</h2>Specify that <a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> does not rebind any of the printer control variables <pre><code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-interned-symbol">*PRINT-...</span>)</span>
</span></code></pre> except as follows: <br/>~A     Binds <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-escape*">*print-escape*</a> to <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a>. <br/>~S     Binds <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-escape*">*print-escape*</a> to <a class="section-reference" href="../chapter-26.xhtml#section-T">T</a>. <br/>~D     Binds <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-escape*">*print-escape*</a> to <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a>, <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-radix*">*print-radix*</a> to <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a>, and     <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-base*">*print-base*</a> to 10. <br/>~B     Binds <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-escape*">*print-escape*</a> to <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a>, <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-radix*">*print-radix*</a> to <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a>, and     <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-base*">*print-base*</a> to 2. <br/>~O     Binds <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-escape*">*print-escape*</a> to <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a>, <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-radix*">*print-radix*</a> to <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a>, and     <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-base*">*print-base*</a> to 8. <br/>~X     Binds <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-escape*">*print-escape*</a> to <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a>, <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-radix*">*print-radix*</a> to <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a>, and     <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-base*">*print-base*</a> to 16. <br/>~R     Iff a first argument is specified, binds <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-escape*">*print-escape*</a> to <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a>,     <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-radix*">*print-radix*</a> to <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a>, and <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-base*">*print-base*</a> to the value of the first     argument. <br/>    Iff no aruments are specified, binds <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-base*">*print-base*</a> to 10. <br/>~@C     Binds <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-escape*">*print-escape*</a> to <a class="section-reference" href="../chapter-26.xhtml#section-T">T</a>. <br/>~F,~G,~E,~$     Binds <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-escape*">*print-escape*</a> to <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a>. <br/></section><section id="section-Test Cases/Examples" class="section"><h2 class="section-title">Test Cases/Examples</h2><pre><pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="special-operator-reference" href="../chapter-5.xhtml#special-operator-let">let</a> <span class="syntax-cons">(<span class="syntax-cons">(<span class="syntax-interned-symbol">TEST</span> <span class="syntax-quote">'<span class="syntax-function">#'<span class="syntax-cons">(<a class="macro-reference" href="../chapter-3.xhtml#macro-lambda">lambda</a> <span class="syntax-cons">(<span class="syntax-interned-symbol">X</span>)</span>
		 <span class="syntax-cons">(<a class="special-operator-reference" href="../chapter-5.xhtml#special-operator-let">let</a> <span class="syntax-cons">(<span class="syntax-cons">(<a class="variable-reference" href="../chapter-22.xhtml#variable-*print-pretty*">*print-pretty*</a> <a class="section-reference" href="../chapter-26.xhtml#section-T">T</a>)</span>)</span>
		   <span class="syntax-cons">(<a class="function-reference" href="../chapter-22.xhtml#function-print">print</a> <span class="syntax-interned-symbol">X</span>)</span>
		   <span class="syntax-cons">(<a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> <a class="section-reference" href="../chapter-26.xhtml#section-T">T</a> <span class="syntax-string">"~%~S "</span> <span class="syntax-interned-symbol">X</span>)</span>
		   <span class="syntax-cons">(<a class="function-reference" href="../chapter-21.xhtml#function-terpri">terpri</a>)</span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-22.xhtml#function-princ">princ</a> <span class="syntax-interned-symbol">X</span>)</span> <span class="syntax-cons">(<a class="function-reference" href="../chapter-22.xhtml#function-princ">princ</a> <span class="syntax-string">" "</span>)</span>
		   <span class="syntax-cons">(<a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> <a class="section-reference" href="../chapter-26.xhtml#section-T">T</a> <span class="syntax-string">"~%~A "</span> <span class="syntax-interned-symbol">X</span>)</span>)</span>)</span></span></span>)</span>)</span>
  <span class="syntax-cons">(<a class="function-reference" href="../chapter-5.xhtml#function-funcall">funcall</a> <span class="syntax-cons">(<a class="function-reference" href="../chapter-3.xhtml#function-eval">eval</a> <span class="syntax-interned-symbol">TEST</span>)</span> <span class="syntax-interned-symbol">TEST</span>)</span>)</span>
</span></code></pre><br/><br/>This should print four copies of the above lambda expression.  The<br/>first pair should appear identical and the second pair should appear<br/>identical.  The only difference between the two pairs should be the<br/>absence of string quotes in the second pair.<br/><br/></pre></section><section id="section-Rationale" class="section"><h2 class="section-title">Rationale</h2><a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> should interact with the printer control variables in a predictable way.  This proposal is one of the two simplest possible definitions and provides the most flexibility to the user. <br/>A major advantage of this proposal is that the following two expressions are guaranteed to have exactly the same effect: <br/>    <pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> <a class="type-reference" href="../chapter-21.xhtml#type-stream">stream</a> <span class="syntax-string">"~S"</span> <span class="syntax-interned-symbol">object</span>)</span>
</span></code></pre>     <pre><code><span class="syntax-root"><span class="syntax-cons">(<a class="function-reference" href="../chapter-22.xhtml#function-prin1">prin1</a> <span class="syntax-interned-symbol">object</span> <a class="type-reference" href="../chapter-21.xhtml#type-stream">stream</a>)</span>
</span></code></pre> <br/>Thus use or non-use of <a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> becomes a purely stylistic matter. <br/></section><section id="section-Current practice" class="section"><h2 class="section-title">Current practice</h2>Ibuki Lisp and the TI Explorer obey the binding of <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-pretty*">*print-pretty*</a>. Lucid Common Lisp always applies ~A and ~S with <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-pretty*">*print-pretty*</a> bound to <a class="section-reference" href="../chapter-1.xhtml#section-NIL">NIL</a>. <br/></section><section id="section-Cost to Implementors" class="section"><h2 class="section-title">Cost to Implementors</h2>While changing <a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> to not bind *PRINT-foo* variables is trivial, there are some painful implications.  How does a pretty-printing ~A interact with MINCOL, etc?  How much of the user interface depends on <a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> in ways that might be uglified by pretty printing? <br/></section><section id="section-Cost to Users" class="section"><h2 class="section-title">Cost to Users</h2>Truely portable code shouldn't be affected because existing implementations are inconsistent.  Despite this, there are probably a number of user programs in non-complying implementations which will have to change whichever way this is decided. <br/></section><section id="section-Cost of non-Adoption" class="section"><h2 class="section-title">Cost of non-Adoption</h2>The interaction of <a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> and the printer control variables (especially <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-pretty*">*print-pretty*</a>) will remain undefined.  This will continue to make portable Common Lisp programming harder than it need be. <br/></section><section id="section-Benefits" class="section"><h2 class="section-title">Benefits</h2>Life will be easier for users in two ways: <pre><code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-number">1</span>)</span>
</span></code></pre> one more portability problem will be removed, and <pre><code><span class="syntax-root"><span class="syntax-cons">(<span class="syntax-number">2</span>)</span>
</span></code></pre> users will be more likely to be able to persuade environmental features like debuggers to print in their preferred way. <br/></section><section id="section-Aesthetics" class="section"><h2 class="section-title">Aesthetics</h2>The interaction between two related parts of output will be clarified in a simple way. <br/></section><section id="section-Discussion" class="section"><h2 class="section-title">Discussion</h2>It is important to specify exactly what of Common Lisp's special variables get rebound by other functions and macros in Common Lisp. This cleanup issue addresses the interaction of <a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> and the *PRINT-  variables. There may be other similar interactions in  Common Lisp that need clarification. <br/>Otherwise, code that depends on <a class="function-reference" href="../chapter-22.xhtml#function-format">format</a>s action in one implementation will not port to others that do not have the same behavior. <br/>CLtL might change as follows: <br/>Add a header "Printer Control Variables" before the description of <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-escape*">*print-escape*</a> on page 370. <br/>Add the following paragraph to page 386 just before the paragraph starting with "It is an error": <br/>    "The <a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> function by itself never binds any of the printer     control variables.  Specific <a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> directives bind exactly the     printer control variables specified in their description.  While     implementations may specify the binding of new, implementation     specific printer control variables for each <a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> directive, they     may neither bind any standard printer control variables not     specified in description of a <a class="function-reference" href="../chapter-22.xhtml#function-format">format</a> directive nor fail to bind     any standard printer control variables as specified in the     description." <br/>There was some discussion on whether <a class="variable-reference" href="../chapter-22.xhtml#variable-*print-base*">*print-base*</a> should be bound for ~F, ~G, ~E, and ~$.  This is not necessary because page 341 of CLtL states that floating point numbers are always printed in base 10. </section></div></main><footer>Copyright © 2021 Jan Moringen</footer></body></html>